<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>Viz on üëã hi, I‚Äôm basile</title><link>https://basilesimon.fr/tags/viz?campaign=rss</link><author>Basile Simon</author><description>Recent content in Viz on üëã hi, I‚Äôm basile</description><generator>Hugo</generator><language>en-gb</language><copyright>Copyright 2025 Basile Simon. Licensed under CC BY 4.0.</copyright><lastBuildDate>Wed, 25 Nov 2020 00:00:00 +0000</lastBuildDate><atom:link href="https://basilesimon.fr/tags/viz/index.xml" rel="self" type="application/rss+xml"/><item><title>Portfolio case study: Machine learning's take on Brexit</title><link>https://basilesimon.fr/blog/portfolio-brexit-rift-machine-learning?campaign=rss</link><pubDate>Wed, 25 Nov 2020 00:00:00 +0000</pubDate><author>Basile Simon</author><dc:creator>Basile Simon</dc:creator><guid>https://basilesimon.fr/blog/portfolio-brexit-rift-machine-learning/</guid><description>&lt;p>&lt;strong>An original data-driven experiment looking at how Brexit splits the Tories. Modelling of a dataset to test a hypothesis.&lt;/strong>&lt;/p>
&lt;hr>
&lt;h3 id="project-course">Project course&lt;/h3>
&lt;p>The project came to be as a backburner piece for my contribution to the Europe, Middle East and Africa Reuters file: a kind of backgrounder, explainer story we could mention and push out again every once in a while.&lt;/p>
&lt;p>The central question was whether we could back up the feeling Lobby reporters had that there were several groups of Tories, so-called &amp;ldquo;tribes,&amp;rdquo; with different attitudes to Brexit ‚Äî while Labour parliamentarians were relatively united in pushing back against Theresa May&amp;rsquo;s deal.&lt;/p></description><content:encoded><![CDATA[<p><strong>An original data-driven experiment looking at how Brexit splits the Tories. Modelling of a dataset to test a hypothesis.</strong></p>
<hr>
<h3 id="project-course">Project course</h3>
<p>The project came to be as a backburner piece for my contribution to the Europe, Middle East and Africa Reuters file: a kind of backgrounder, explainer story we could mention and push out again every once in a while.</p>
<p>The central question was whether we could back up the feeling Lobby reporters had that there were several groups of Tories, so-called &ldquo;tribes,&rdquo; with different attitudes to Brexit ‚Äî while Labour parliamentarians were relatively united in pushing back against Theresa May&rsquo;s deal.</p>
<p><strong><a href="https://graphics.reuters.com/BRITAIN-EU-LEADER/010092Q33KW/index.html">The main Reuters Graphics story</a></strong> studied 12 key votes on amendments to the deal, which were fascinating as they reprensented new ideas from parliamentarians about what to do about Brexit.</p>
<p><strong><a href="https://blog.basilesimon.fr/2019/10/06/brexit-machine-learning/">I also published a follow-up looking at 238 votes</a></strong> and feeding the records to a machine learning algorithm, which as it was a lot more speculative was not Reuters&rsquo; cup of tea.</p>
<hr>
<p><img src="assets/tsne.svg" alt=""></p>
<h2 id="t-sne-for-machine-mapping-of-brexit-personalities">t-SNE for machine mapping of Brexit personalities</h2>
<p>Pellentesque dapibus suscipit ligula.  Donec posuere augue in quam.  Etiam vel tortor sodales tellus ultricies commodo.  Suspendisse potenti.  Aenean in sem ac leo mollis blandit.  Donec neque quam, dignissim in, mollis nec, sagittis eu, wisi.  Phasellus lacus.  Etiam laoreet quam sed arcu.  Phasellus at dui in ligula mollis ultricies.  Integer placerat tristique nisl.  Praesent augue.  Fusce commodo.  Vestibulum convallis, lorem a tempus semper, dui dui euismod elit, vitae placerat urna tortor vitae lacus.  Nullam libero mauris, consequat quis, varius et, dictum id, arcu.  Mauris mollis tincidunt felis.  Aliquam feugiat tellus ut neque.  Nulla facilisis, risus a rhoncus fermentum, tellus tellus lacinia purus, et dictum nunc justo sit amet elit.</p>
<p>tktktk</p>
<hr>
<p><img src="assets/brexit-split.png" alt="">
<img src="assets/brexit-decision-tree.png" alt="">
<img src="assets/brexit-rift-reuters.png" alt=""></p>
<h2 id="a-decision-tree-through-original-solutions-to-brexit">A decision tree through original solutions to Brexit</h2>
<p>tktktk
Pellentesque dapibus suscipit ligula.  Donec posuere augue in quam.  Etiam vel tortor sodales tellus ultricies commodo.  Suspendisse potenti.  Aenean in sem ac leo mollis blandit.  Donec neque quam, dignissim in, mollis nec, sagittis eu, wisi.  Phasellus lacus.  Etiam laoreet quam sed arcu.  Phasellus at dui in ligula mollis ultricies.  Integer placerat tristique nisl.  Praesent augue.  Fusce commodo.  Vestibulum convallis, lorem a tempus semper, dui dui euismod elit, vitae placerat urna tortor vitae lacus.  Nullam libero mauris, consequat quis, varius et, dictum id, arcu.  Mauris mollis tincidunt felis.  Aliquam feugiat tellus ut neque.  Nulla facilisis, risus a rhoncus fermentum, tellus tellus lacinia purus, et dictum nunc justo sit amet elit.</p>
<hr>
<h3 id="data-work-and-modelling">Data work and modelling</h3>
<p>To make out groups of MPs, we looked at their voting record. I&rsquo;m forever grateful to <a href="https://evanodell.com/">Evan Odell</a>, who maintains R packages I&rsquo;ve used through my time in news.</p>
<p><a href="https://github.com/evanodell/hansard">@evanhodell/hansard</a>&rsquo;s was used to fetch a bunch of data from an original <a href="https://www.instituteforgovernment.org.uk/">Institute for Government</a> research, which highlighted recent Brexit-related votes.</p>
<p><em>Thanks for keeping RSS alive!</em></p>]]></content:encoded><category>portfolio</category><category>viz</category><dc:date>2020-11-25T00:00:00Z</dc:date><dc:rights>CC BY 4.0</dc:rights></item><item><title>Berlin Stolpersteine Data: Comparing Memorial Databases</title><link>https://basilesimon.fr/blog/stolpersteine-maps?campaign=rss</link><pubDate>Fri, 13 Nov 2020 00:00:00 +0000</pubDate><author>Basile Simon</author><dc:creator>Basile Simon</dc:creator><guid>https://basilesimon.fr/blog/stolpersteine-maps/</guid><description>&lt;blockquote>
&lt;p>&lt;strong>December 2025 Update:&lt;/strong> I&amp;rsquo;ve refreshed the data for this analysis. The landscape has changed dramatically‚ÄîWikidata&amp;rsquo;s coverage has improved so much that it now &lt;em>exceeds&lt;/em> the Berlin-specific database. See updated numbers below.&lt;/p>
&lt;/blockquote>
&lt;hr>
&lt;p>Here are two datasets documenting Berlin&amp;rsquo;s Stolpersteine memorial plaques. In 2020, their coverage differed dramatically. Four years later, Wikidata has caught up‚Äîand surpassed‚Äîthe Berlin-specific database.&lt;/p>
&lt;p>üî∏ Wikidata reference üîπ Stolpersteine-berlin dataset
&lt;a href="https://observablehq.com/@basilesimon/berlin-stolpersteine">&lt;img src="assets/stolpersteine-maps.png" alt="maps of Stolpersteine">&lt;/a>
&lt;svg role="img" viewBox="0 0 25 28" width="25" height="28" aria-label="Observable" fill="currentColor" style="width: 22px; transform: translateY(5px);" class="near-black">&lt;path d="M12.5 22.6667C11.3458 22.6667 10.3458 22.4153 9.5 21.9127C8.65721 21.412 7.98339 20.7027 7.55521 19.8654C7.09997 18.9942 6.76672 18.0729 6.56354 17.1239C6.34796 16.0947 6.24294 15.0483 6.25 14C6.25 13.1699 6.30417 12.3764 6.41354 11.6176C6.52188 10.8598 6.72292 10.0894 7.01563 9.30748C7.30833 8.52555 7.68542 7.84763 8.14479 7.27274C8.62304 6.68378 9.24141 6.20438 9.95208 5.87163C10.6979 5.51244 11.5458 5.33333 12.5 5.33333C13.6542 5.33333 14.6542 5.58467 15.5 6.08733C16.3428 6.588 17.0166 7.29733 17.4448 8.13459C17.8969 8.99644 18.2271 9.9103 18.4365 10.8761C18.6448 11.841 18.75 12.883 18.75 14C18.75 14.8301 18.6958 15.6236 18.5865 16.3824C18.4699 17.1702 18.2639 17.9446 17.9719 18.6925C17.6698 19.4744 17.2948 20.1524 16.8427 20.7273C16.3906 21.3021 15.7927 21.7692 15.0479 22.1284C14.3031 22.4876 13.4542 22.6667 12.5 22.6667ZM14.7063 16.2945C15.304 15.6944 15.6365 14.864 15.625 14C15.625 13.1073 15.326 12.3425 14.7292 11.7055C14.1313 11.0685 13.3885 10.75 12.5 10.75C11.6115 10.75 10.8688 11.0685 10.2708 11.7055C9.68532 12.3123 9.36198 13.1405 9.375 14C9.375 14.8927 9.67396 15.6575 10.2708 16.2945C10.8688 16.9315 11.6115 17.25 12.5 17.25C13.3885 17.25 14.124 16.9315 14.7063 16.2945ZM12.5 27C19.4031 27 25 21.1792 25 14C25 6.82075 19.4031 1 12.5 1C5.59687 1 0 6.82075 0 14C0 21.1792 5.59687 27 12.5 27Z" fill="currentColor">&lt;/path>&lt;/svg>
&lt;a href="https://observablehq.com/@basilesimon/berlin-stolpersteine">View on Observable&lt;/a>&lt;/p></description><content:encoded><![CDATA[<blockquote>
<p><strong>December 2025 Update:</strong> I&rsquo;ve refreshed the data for this analysis. The landscape has changed dramatically‚ÄîWikidata&rsquo;s coverage has improved so much that it now <em>exceeds</em> the Berlin-specific database. See updated numbers below.</p>
</blockquote>
<hr>
<p>Here are two datasets documenting Berlin&rsquo;s Stolpersteine memorial plaques. In 2020, their coverage differed dramatically. Four years later, Wikidata has caught up‚Äîand surpassed‚Äîthe Berlin-specific database.</p>
<p>üî∏ Wikidata reference üîπ Stolpersteine-berlin dataset
<a href="https://observablehq.com/@basilesimon/berlin-stolpersteine"><img src="assets/stolpersteine-maps.png" alt="maps of Stolpersteine"></a>
<svg role="img" viewBox="0 0 25 28" width="25" height="28" aria-label="Observable" fill="currentColor" style="width: 22px; transform: translateY(5px);" class="near-black"><path d="M12.5 22.6667C11.3458 22.6667 10.3458 22.4153 9.5 21.9127C8.65721 21.412 7.98339 20.7027 7.55521 19.8654C7.09997 18.9942 6.76672 18.0729 6.56354 17.1239C6.34796 16.0947 6.24294 15.0483 6.25 14C6.25 13.1699 6.30417 12.3764 6.41354 11.6176C6.52188 10.8598 6.72292 10.0894 7.01563 9.30748C7.30833 8.52555 7.68542 7.84763 8.14479 7.27274C8.62304 6.68378 9.24141 6.20438 9.95208 5.87163C10.6979 5.51244 11.5458 5.33333 12.5 5.33333C13.6542 5.33333 14.6542 5.58467 15.5 6.08733C16.3428 6.588 17.0166 7.29733 17.4448 8.13459C17.8969 8.99644 18.2271 9.9103 18.4365 10.8761C18.6448 11.841 18.75 12.883 18.75 14C18.75 14.8301 18.6958 15.6236 18.5865 16.3824C18.4699 17.1702 18.2639 17.9446 17.9719 18.6925C17.6698 19.4744 17.2948 20.1524 16.8427 20.7273C16.3906 21.3021 15.7927 21.7692 15.0479 22.1284C14.3031 22.4876 13.4542 22.6667 12.5 22.6667ZM14.7063 16.2945C15.304 15.6944 15.6365 14.864 15.625 14C15.625 13.1073 15.326 12.3425 14.7292 11.7055C14.1313 11.0685 13.3885 10.75 12.5 10.75C11.6115 10.75 10.8688 11.0685 10.2708 11.7055C9.68532 12.3123 9.36198 13.1405 9.375 14C9.375 14.8927 9.67396 15.6575 10.2708 16.2945C10.8688 16.9315 11.6115 17.25 12.5 17.25C13.3885 17.25 14.124 16.9315 14.7063 16.2945ZM12.5 27C19.4031 27 25 21.1792 25 14C25 6.82075 19.4031 1 12.5 1C5.59687 1 0 6.82075 0 14C0 21.1792 5.59687 27 12.5 27Z" fill="currentColor"></path></svg>
<a href="https://observablehq.com/@basilesimon/berlin-stolpersteine">View on Observable</a></p>
<hr>
<h2 id="background">Background</h2>
<p>In the night of Nov 9 to 10, 1938, Nazi Germany&rsquo;s SA forces carried out a devastating pogrom. The event came to be called <a href="https://en.wikipedia.org/wiki/Kristallnacht"><em>Kristallnacht</em>, &ldquo;The Night of Broken Glass.&rdquo;</a></p>
<p>Last week, as I walked in the street in the evening I noticed that some of the brass plaques had candles and roses next to them, a silent and unattended vigil in the street. It was in remembrance of Kristallnacht. The picture below is mine:</p>
<p><img src="assets/stolpersteine.jpg" alt="A Stolperstein memorial plaque in a Berlin street, with candles placed beside it"></p>
<p>These plaques are Stolpersteine‚Äîthe world&rsquo;s largest decentralized memorial, with over 100,000 brass-topped concrete cubes installed across Europe by artist Gunter Demnig:</p>
<blockquote>
<p>&ldquo;A Stolperstein (pronounced [Àà Ét…îlp…êÀå Éta…™n]; literally &ldquo;stumbling stone&rdquo;, metaphorically a &ldquo;stumbling block&rdquo;) is a sett-size, ten-centimetre (3.9 in) concrete cube bearing a brass plate inscribed with the name and life dates of victims of Nazi extermination or persecution.&rdquo;</p>
</blockquote>
<blockquote>
<p>&ldquo;Today, Stolpersteine are being realized for Jews, Sinti and Roma, people from the political or religious resistance, victims of the &ldquo;euthanasia&rdquo; murders, homosexuals, Jehovahs Witnesses and for people who were persecuted for being declared to be &ldquo;asocial&rdquo;.&rdquo;</p>
</blockquote>
<p><a href="https://en.wikipedia.org/wiki/Stolperstein">(Wikipedia)</a></p>
<hr>
<h2 id="the-data-2020-vs-2025">The Data: 2020 vs 2025</h2>
<p>These are two public records of the location and number of Berlin&rsquo;s Stolpersteine:</p>
<ul>
<li>the <a href="https://www.wikidata.org/wiki/Q26703203">Wikidata database</a>,</li>
<li>and the dataset produced by <a href="https://www.stolpersteine-berlin.de/en">stolpersteine-berlin.de</a>, referenced in the <a href="https://daten.berlin.de/datensaetze/liste-der-stolpersteine-berlin">daten.berlin.de</a> catalogue. It describes itself as &ldquo;a liaison office between the artist Gunter Demnig together with his team and the local Stolperstein-groups.&rdquo;</li>
</ul>
<table>
  <thead>
      <tr>
          <th>Source</th>
          <th>2020 Records</th>
          <th>2025 Records</th>
          <th>Change</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><a href="https://www.stolpersteine-berlin.de/en">stolpersteine-berlin.de</a></td>
          <td>3,307</td>
          <td><strong>10,341</strong></td>
          <td>+213%</td>
      </tr>
      <tr>
          <td><a href="https://www.wikidata.org/wiki/Q26703203">Wikidata</a> (Berlin)</td>
          <td>~1,780</td>
          <td><strong>11,992</strong></td>
          <td>+574%</td>
      </tr>
      <tr>
          <td>Wikidata (all Europe)</td>
          <td>~14,000</td>
          <td><strong>47,320</strong></td>
          <td>+238%</td>
      </tr>
  </tbody>
</table>
<p>In 2020, there were only about <strong>1,780 Wikidata records</strong> in Berlin, overwhelmingly in the west of the city. Stolpersteine-berlin had <strong>3,307 records</strong>, many including several family members at the same address.</p>
<p>By 2025, the situation has reversed. Wikidata now has <strong>more Berlin records</strong> than the Berlin-specific database, thanks to community contributors adding nearly 35,000 geocoded entries across Europe.</p>
<p>The Wikidata dataset spans not only all of Germany, but all of Europe:</p>
<iframe width="100%" height="584" frameborder="0"
  src="https://observablehq.com/embed/@basilesimon/berlin-stolpersteine?cell=viz"></iframe>
<h2 id="technical-notes">Technical Notes</h2>
<p>The stolpersteine-berlin.de site now provides a <a href="https://www.stolpersteine-berlin.de/en/api/json/stolpersteine.json">JSON API</a> with pre-geocoded coordinates. The old XML endpoint I used in 2020 no longer exists.</p>
<p>For Wikidata, a SPARQL query retrieves all Stolpersteine with coordinates:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sparql" data-lang="sparql"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">SELECT</span> <span style="color:#008080">?item</span> <span style="color:#008080">?itemLabel</span> <span style="color:#008080">?coords</span> <span style="color:#000;font-weight:bold">WHERE</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#008080">?item</span> <span style="color:#555">wdt</span>:<span style="color:#000080">P31</span> <span style="color:#555">wd</span>:<span style="color:#000080">Q26703203</span> .
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">OPTIONAL</span> { <span style="color:#008080">?item</span> <span style="color:#555">wdt</span>:<span style="color:#000080">P625</span> <span style="color:#008080">?coords</span> }
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">SERVICE</span> <span style="color:#555">wikibase</span>:<span style="color:#000080">label</span> { <span style="color:#555">bd</span>:<span style="color:#000080">serviceParam</span> <span style="color:#555">wikibase</span>:<span style="color:#000080">language</span> <span style="color:#d14">&#34;en&#34;</span> }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<p><em>Originally published November 2020. Updated December 2025 with fresh data.</em></p>
<p><em>Thanks for keeping RSS alive!</em></p>]]></content:encoded><category>observable</category><category>viz</category><category>berlin</category><category>stolpersteine</category><category>open-data</category><category>holocaust-memorial</category><enclosure url="assets/stolpersteine-maps.png" type="image/jpeg"/><dc:description>Comparing Stolpersteine memorial datasets: Wikidata vs stolpersteine-berlin.de. Updated 2025 analysis with 10,000+ Berlin records and interactive maps.</dc:description><dc:date>2020-11-13T00:00:00Z</dc:date><dc:rights>CC BY 4.0</dc:rights></item><item><title>Portfolio case study: Reuters' 2019 general election results page</title><link>https://basilesimon.fr/blog/portfolio-general-election-2019-britain?campaign=rss</link><pubDate>Sun, 08 Nov 2020 00:00:00 +0000</pubDate><author>Basile Simon</author><dc:creator>Basile Simon</dc:creator><guid>https://basilesimon.fr/blog/portfolio-general-election-2019-britain/</guid><description>&lt;p>&lt;img src="assets/ge2019-header.png" alt="Intro to GE2019 page screenshot">&lt;/p>
&lt;p>&lt;strong>A node backend and a modular, reactive front page visualising the UK general election results, as they happened. For Reuters Graphics.&lt;/strong>&lt;/p>
&lt;p>Unfortunately, this page was deleted from the internet.&lt;/p>
&lt;hr>
&lt;h2 id="front-end-the-results-page">Front end: the results page&lt;/h2>
&lt;p>The page was built to be modular, i.e. to work this way:&lt;/p>
&lt;ul>
&lt;li>clients must be able to pick and choose which graphics they want, from one of them to all of them,&lt;/li>
&lt;li>there is only one repository of code I update and push out to clients.&lt;/li>
&lt;/ul>
&lt;p>So the main app itself is broken down into sections which are totally independent from one another.&lt;/p></description><content:encoded><![CDATA[<p><img src="assets/ge2019-header.png" alt="Intro to GE2019 page screenshot"></p>
<p><strong>A node backend and a modular, reactive front page visualising the UK general election results, as they happened. For Reuters Graphics.</strong></p>
<p>Unfortunately, this page was deleted from the internet.</p>
<hr>
<h2 id="front-end-the-results-page">Front end: the results page</h2>
<p>The page was built to be modular, i.e. to work this way:</p>
<ul>
<li>clients must be able to pick and choose which graphics they want, from one of them to all of them,</li>
<li>there is only one repository of code I update and push out to clients.</li>
</ul>
<p>So the main app itself is broken down into sections which are totally independent from one another.</p>
<p>The root of the main app, which all clients will run, is then quite minimal in terms of data processing, as it does not need to worry about what kind of data wrangling the modular sections downstream require.</p>
<hr>
<h3 id="selected-graphics">Selected graphics</h3>
<p><strong>A blue wave&hellip; if you don&rsquo;t know where to look</strong><br>
For the results map, we weren&rsquo;t quite ready to commit to cartogram only, for fear that our very international audience wouldn&rsquo;t quite recognise the country.</p>
<p>I felt it was an important thing to include, though, since urban/rural voting patterns are quite different in the UK, and Labour&rsquo;s importance is visually underwhelming otherwise.</p>
<p>So I built both, and I&rsquo;m particularly proud of I managed to run 650 <a href="https://github.com/d3/d3-transition#transition_attrTween">tween interpolators</a> at the same time to transition between the two states. <a href="https://github.com/veltman/flubber">Noah, thanks for Flubber</a> once again!</p>
<video autoplay loop muted playsinline class="video-background" style="width:100%">
  <source src="assets/ge2019-maps.mp4" type="video/mp4">
</video>
<div style="margin-top: 70px"></div>
<p><strong>Visualising change and who won from whom</strong><br>
I&rsquo;m no stranger to ternary plots, which allow to plot three dimensions in an Euclidean space, in 2D. I think The Economist did a chart like this just before the election (if it was you, please email me a link :)).</p>
<p>I wanted to show the swing and who picked up seats from whom, but we weren&rsquo;t sure how the night was going to play out, and it would have looked very empty for a while. So this was done live and added as a hot commit overnight. And I&rsquo;m quite pleased (in a non-political way) about how well it shows Labour losing seats to quite literally everyone.</p>
<p><img src="assets/ge2019-ternaries.png" alt="Screenshot of the GE2019 ternary charts"></p>
<div style="margin-top: 70px"></div>
<p>And finally, the classic barcode references, which I think do a decent job of conveying the general sense of distribution (and outliers) as well as the general picture.</p>
<p><img src="assets/ge2019-misc.png" alt="Screenshot of miscellaneous bits of the GE2019 page"></p>
<hr>
<h2 id="backend">Backend</h2>
<p>The backend I put together was two-fold:</p>
<ul>
<li>A <code>bash</code> scraper polled the PA&rsquo;s FTP server for data they&rsquo;d put out (yes you read this right: FTP) and would mirror and version this data to our <code>S3</code> buckets,</li>
<li>A <code>node</code> app would then poll these buckets and take it from there.</li>
</ul>
<p>In this instance, the role of the backend is to build up, from all the XML files dropped by the PA, a JSON-like representation of the election results as they currently stand.</p>
<p>There are quite a few hoops to jump through and hurdles to clear, such as recounts and corrections, and unfortunately this process can be quite manual (e.g. file names) or edge cases (e.g. the Speaker&rsquo;s constituency is handled differently by different news organisations).</p>
<hr>
<h2 id="inception-and-duties">Inception and duties</h2>
<p>I designed, built and maintained this project, under the careful editing of Simon Scarr.</p>
<p>We had code reviews and handovers with colleagues in other offices (Bangalore, Singapore, New York City) in case I&rsquo;d be incapacitated, or if I needed a rest overnight.</p>
<p><em>Thanks for keeping RSS alive!</em></p>]]></content:encoded><category>portfolio</category><category>viz</category><enclosure url="https://basilesimon.fr/assets/ge2019-header.png" type="image/jpeg"/><dc:date>2020-11-08T00:00:00Z</dc:date><dc:rights>CC BY 4.0</dc:rights></item><item><title>A beeswarm layout in Observable -- on deadline</title><link>https://basilesimon.fr/blog/observable-beeswarm?campaign=rss</link><pubDate>Wed, 21 Oct 2020 00:00:00 +0000</pubDate><author>Basile Simon</author><dc:creator>Basile Simon</dc:creator><guid>https://basilesimon.fr/blog/observable-beeswarm/</guid><description>&lt;p>&lt;img src="assets/beeswarm-obs.png" alt="">&lt;/p>
&lt;p>I recently had to complete a technical test for a role I&amp;rsquo;m interested in.&lt;/p>
&lt;p>The task: from &lt;a href="https://www.globalwitness.org/en/campaigns/oil-gas-and-mining/chevron-stop-funding-racism/">a story out of the Global Witness website&lt;/a>, can you come up with an alternative visualisation? &lt;strong>You&amp;rsquo;ve got two hours.&lt;/strong>&lt;/p>
&lt;p>As there were no embed constraints, I figured there was no point in faffing with boilerplate code and scaffolds, so I went down the Observable route to put a chart together.&lt;/p>
&lt;p>Here&amp;rsquo;s what we need scales-wise:&lt;/p></description><content:encoded><![CDATA[<p><img src="assets/beeswarm-obs.png" alt=""></p>
<p>I recently had to complete a technical test for a role I&rsquo;m interested in.</p>
<p>The task: from <a href="https://www.globalwitness.org/en/campaigns/oil-gas-and-mining/chevron-stop-funding-racism/">a story out of the Global Witness website</a>, can you come up with an alternative visualisation? <strong>You&rsquo;ve got two hours.</strong></p>
<p>As there were no embed constraints, I figured there was no point in faffing with boilerplate code and scaffolds, so I went down the Observable route to put a chart together.</p>
<p>Here&rsquo;s what we need scales-wise:</p>
<ul>
<li>On the y axis, the amount of the individual donations range from 0 to $10,000 &ndash; we&rsquo;ll use a linear scale which domain is mapped to this extent;</li>
<li>On the x axis, we&rsquo;ve got two categories: the donations that pass the NAACP criteria, and those that don&rsquo;t. We cue an ordinal scale which domain are these values;</li>
<li>A simple colour scale;</li>
</ul>
<hr>
<p>But as donation amounts overlap each other, so do our circles. Here they are, with a small increasing offset to show this banding effect:</p>
<p><img src="assets/beeswarm-overlap.png" alt=""></p>
<p>Comes the force layout to the rescue, adding some simulated entropy to the x/y coordinates of our circles and allowing us to appreciate the difference in scale between the two columns.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">const</span> simulation <span style="color:#000;font-weight:bold">=</span> d3
</span></span><span style="display:flex;"><span>  .forceSimulation(data)
</span></span><span style="display:flex;"><span>  .force(<span style="color:#d14">&#39;x&#39;</span>, d3.forceX(d =&gt; x(d.category)).strength(<span style="color:#099">0.2</span>))
</span></span><span style="display:flex;"><span>  .force(<span style="color:#d14">&#39;y&#39;</span>, d3.forceY(d =&gt; y(<span style="color:#000;font-weight:bold">+</span>d.donationUSD)).strength(<span style="color:#099">1</span>))
</span></span><span style="display:flex;"><span>  .force(<span style="color:#d14">&#39;collide&#39;</span>, d3.forceCollide(d =&gt; size(<span style="color:#0086b3">Math</span>.sqrt(<span style="color:#000;font-weight:bold">+</span>d.donationUSD))))
</span></span><span style="display:flex;"><span>  .alphaDecay(<span style="color:#099">0</span>)
</span></span><span style="display:flex;"><span>  .alpha(<span style="color:#099">0.3</span>)
</span></span><span style="display:flex;"><span>  .stop();
</span></span></code></pre></div><p>We apply three forces to our simulation:</p>
<ul>
<li>One <strong>on the x axis</strong>, so our circles bucket into our two categories. We specify a weak <code>.strength()</code> so they spread out horizontally rather than vertically (and thus are more truthful to the precise donation amounts);</li>
<li>One <strong>on the y axis</strong>, where in this case the <code>.strength()</code> is far greater to squeeze them further, as seen above;</li>
<li>A <strong>collision force</strong> which repels the circles from each other, so as to spread them apart.</li>
</ul>
<p>Here they are, showing the influence of x and y&rsquo;s <code>.strength()</code>:</p>
<video autoplay loop muted playsinline>
       <source src="assets/beeswarm.mp4" type="video/mp4">
</video>
<p>Did I say I had two hours to do this? I had to skimp on the annotations, which I&rsquo;ve positioned manually and quite roughly as <text> elements.</p>
<hr>
<p>Read more:</p>
<ul>
<li><a href="https://observablehq.com/@rospearce/beeswarm">@rospearce&rsquo;s layout greatly helped</a></li>
<li>There appears to be an actual npm module to produce such layouts: <a href="https://github.com/Kcnarf/d3-beeswarm">d3-beeswarm</a></li>
<li><a href="https://www.chartfleau.com/tutorials/d3swarm/">A rather complete tutorial from @chartfleau</a></li>
</ul>
<p><em>Thanks for keeping RSS alive!</em></p>]]></content:encoded><category>observable</category><category>d3</category><category>viz</category><enclosure url="https://basilesimon.fr/assets/beeswarm-obs.png" type="image/jpeg"/><dc:description>A step-by-step walkthrough of a beeswarm layout I produced as an alternative a bar chart</dc:description><dc:date>2020-10-21T00:00:00Z</dc:date><dc:rights>CC BY 4.0</dc:rights></item><item><title>Portfolio case study: Global Witness' Pipedown interactive map</title><link>https://basilesimon.fr/blog/portfolio-global-witness-pipedown-map?campaign=rss</link><pubDate>Wed, 21 Oct 2020 00:00:00 +0000</pubDate><author>Basile Simon</author><dc:creator>Basile Simon</dc:creator><guid>https://basilesimon.fr/blog/portfolio-global-witness-pipedown-map/</guid><description>&lt;p>&lt;img src="assets/gw-full.png" alt="Pipedown screenshot">&lt;/p>
&lt;p>&lt;strong>An interactive map of natural gas infrastructure in the EU, built with Svelte and d3, for Global Witness.&lt;/strong>&lt;/p>
&lt;hr>
&lt;h3 id="some-context">Some context&lt;/h3>
&lt;p>The EU has a rule in place to regulate which electricity and fossil fuel projects it will financially support. These projects include the terminals and pipelines used to import and transport fossil gas ‚Äì sometimes referred to as natural gas. Under this regulation, selected gas projects get fast-track approval and access to billions in public subsidies.&lt;/p></description><content:encoded><![CDATA[<p><img src="assets/gw-full.png" alt="Pipedown screenshot"></p>
<p><strong>An interactive map of natural gas infrastructure in the EU, built with Svelte and d3, for Global Witness.</strong></p>
<hr>
<h3 id="some-context">Some context</h3>
<p>The EU has a rule in place to regulate which electricity and fossil fuel projects it will financially support. These projects include the terminals and pipelines used to import and transport fossil gas ‚Äì sometimes referred to as natural gas. Under this regulation, selected gas projects get fast-track approval and access to billions in public subsidies.</p>
<p>That&rsquo;s a law called TEN-E Regulation.</p>
<p>And it has a problem: it gifts remarkable power over EU policy to an obscure cadre of gas companies called the <em>European Network of Transmission System Operators for Gas</em>, or ENTSOG. Under the law, ENTSOG companies help the EU predict how much gas Europe needs and helps the Commission decide what gas infrastructure projects to support.</p>
<p><strong>Conflict of interest? Legal but non-virtuous circle?</strong></p>
<hr>
<p><strong>For their campaign, Global Witness wanted to visualise all the gas projects the EU has subsidised, and how much projects backed by these ENTSOG companies have received.</strong></p>
<h3 id="project-course">Project course</h3>
<p>From a rough interactive map prototype, I pitched a stack proposal and a five-day contract, which I worked over three or four weeks.</p>
<p>I focused on the complex interactivity first, bringing in styles from GW&rsquo;s guidelines as we went along. We kept the show on track with frequent reviews, which were helpful but greatly helped by the fact that we were all on the same page and that my proposals and initiative seemed to be appreciated.</p>
<p>We kept some on-call hours for publication day, but it all went smoothly.</p>
<hr>
<h3 id="visual-density-and-jargon">Visual density and jargon</h3>
<p>The campaign is aimed at European lawmakers or persons of influence. Folks who know about a particular country, or particular infrastructure projects, and who <em>will</em> want to know the precise names and amounts.</p>
<p>So we&rsquo;re getting away with this kind of rather busy display, which has the merit of displaying <em>a lot</em> of information, though it&rsquo;s rather wordy:</p>
<p><img src="assets/gw-bulgaria.png" alt=""></p>
<h3 id="link-in-place">Link in place</h3>
<p>Readers can link to a specific country, as well as tweet some pre-defined patterns of copy which are also country-specific. Here again, we&rsquo;re helping the MEP tweet out their outrage about projects in their country.</p>
<h3 id="explorable-clickable-hoverable">Explorable, clickable, hoverable</h3>
<p>This is where reactive programming patterns really help:</p>
<p>We use <a href="https://svelte.dev/">Svelte</a> to set up a central, app-wide source of truth, which the different components and views can access, and sometimes edit.</p>
<p>This allows us to have different behaviours at different moments. For example:</p>
<ul>
<li>When looking at the European level, we don&rsquo;t highlight and can&rsquo;t click the individual projects ; but we can do so at the country level.</li>
<li>We display different data depending on the country highlighted. For the Trans Adriatic Pipeline, a Belgian MEP will see the funding of Belgian ENTSOG companies ; an Italian will see their side of the projects, and so on.</li>
</ul>
<p><em>Thanks for keeping RSS alive!</em></p>]]></content:encoded><category>portfolio</category><category>viz</category><enclosure url="https://basilesimon.fr/assets/gw-full.png" type="image/jpeg"/><dc:date>2020-10-21T00:00:00Z</dc:date><dc:rights>CC BY 4.0</dc:rights></item><item><title>Exercising in a 1km radius (another Strava data viz)</title><link>https://basilesimon.fr/blog/1km-covid-viz?campaign=rss</link><pubDate>Sun, 26 Apr 2020 00:00:00 +0000</pubDate><author>Basile Simon</author><dc:creator>Basile Simon</dc:creator><guid>https://basilesimon.fr/blog/1km-covid-viz/</guid><description>&lt;p>&lt;img src="assets/covid-viz-terrain.png" alt="">&lt;/p>
&lt;p>So, I&amp;rsquo;m in France right now, and with this lockdown going on we&amp;rsquo;re quite restricted on the physical exercise front.&lt;/p>
&lt;p>Technically we&amp;rsquo;re allowed to go out for a sweat, but can&amp;rsquo;t go for longer than an hour a day, and no further than a one-kilometre radius away rom home.&lt;/p>
&lt;p>With this in mind and for no particular reason I set off to cycle, run, or walk every street in this virtual confinement circle.&lt;/p></description><content:encoded><![CDATA[<p><img src="assets/covid-viz-terrain.png" alt=""></p>
<p>So, I&rsquo;m in France right now, and with this lockdown going on we&rsquo;re quite restricted on the physical exercise front.</p>
<p>Technically we&rsquo;re allowed to go out for a sweat, but can&rsquo;t go for longer than an hour a day, and no further than a one-kilometre radius away rom home.</p>
<p>With this in mind and for no particular reason I set off to cycle, run, or walk every street in this virtual confinement circle.</p>
<p>I applied similar techniques <a href="blog/strava-rides-map-in-r">as before</a> to collect my Strava activities and overlay them on a collection of OpenStreetMap.</p>
<hr>
<p>Here&rsquo;s a bonus animated version:</p>
<video autoplay controls loop muted playsinline muted style="margin: 0 auto; width: 100%;">
 <source src="assets/output2.mp4" type="video/mp4">
 <p>this video could not be played</p>
</video>
<p><em>Thanks for keeping RSS alive!</em></p>]]></content:encoded><category>r</category><category>viz</category><enclosure url="https://basilesimon.fr/assets/covid-viz-terrain.png" type="image/jpeg"/><dc:description>Animated map of Strava activities during Covid in a one-kilometre radius</dc:description><dc:date>2020-04-26T00:00:00Z</dc:date><dc:rights>CC BY 4.0</dc:rights></item><item><title>Machine learning's take on the Brexit's House of Commons</title><link>https://basilesimon.fr/blog/brexit-machine-learning?campaign=rss</link><pubDate>Sun, 06 Oct 2019 00:00:00 +0000</pubDate><author>Basile Simon</author><dc:creator>Basile Simon</dc:creator><guid>https://basilesimon.fr/blog/brexit-machine-learning/</guid><description>&lt;p>Let&amp;rsquo;s say things are a little confused over here in Brexit Land. To put it lightly, it has become difficult to explain, or simply to fathom what&amp;rsquo;s going to happen next.&lt;/p>
&lt;p>A few months ago I looked at &lt;a href="https://graphics.reuters.com/BRITAIN-EU-LEADER/010092Q33KW/index.html">the rift splitting the Conservative Party&lt;/a>, but the topic kept nagging me.&lt;/p>
&lt;p>&lt;a href="https://graphics.reuters.com/BRITAIN-EU-LEADER/010092Q33KW/index.html">&lt;img src="assets/brexit-split.png" style="width: 50%; margin: auto;">&lt;/img>&lt;/a>&lt;/p>
&lt;p>Obviously the &amp;ldquo;indicative votes&amp;rdquo; were a great tool to identify the &lt;a href="https://ig.ft.com/brexit-tory-tribes/">Brexit &amp;ldquo;tribes,&amp;rdquo;&lt;/a> as they represented such varied opinions, allowing us to build a mental picture of the different kinds of Brexit MPs could support.&lt;/p></description><content:encoded><![CDATA[<p>Let&rsquo;s say things are a little confused over here in Brexit Land. To put it lightly, it has become difficult to explain, or simply to fathom what&rsquo;s going to happen next.</p>
<p>A few months ago I looked at <a href="https://graphics.reuters.com/BRITAIN-EU-LEADER/010092Q33KW/index.html">the rift splitting the Conservative Party</a>, but the topic kept nagging me.</p>
<p><a href="https://graphics.reuters.com/BRITAIN-EU-LEADER/010092Q33KW/index.html"><img src="assets/brexit-split.png" style="width: 50%; margin: auto;"></img></a></p>
<p>Obviously the &ldquo;indicative votes&rdquo; were a great tool to identify the <a href="https://ig.ft.com/brexit-tory-tribes/">Brexit &ldquo;tribes,&rdquo;</a> as they represented such varied opinions, allowing us to build a mental picture of the different kinds of Brexit MPs could support.</p>
<p>But paying close attention to British politics for a while introduces a certain perception bias, whereby we see some MPs as more or less extreme based on our impressions shaped over a few months discusssing the topic ‚Äî the quite questionable data we gathered by reading the news.</p>
<p>So here are my questions:</p>
<p><em><strong>What about the long-term, more latent allegiances MPs might hold?</strong></em></p>
<p><em><strong>Could we do without our &ldquo;Brexit goggles&rdquo; and look at a more impartial, objective picture of our House of Commons?</strong></em></p>
<p>To find out, I fed a number of House of Commons Brexit-related votes to <a href="https://en.wikipedia.org/wiki/T-distributed_stochastic_neighbor_embedding"><code>t-SNE</code>, a machine learning discovery algorithm</a>. The result is below:</p>
<p><img src="assets/tsne.svg"></img></p>
<p><svg role="img" viewBox="0 0 25 28" width="25" height="28" aria-label="Observable" fill="currentColor" style="width: 22px; transform: translateY(5px);" class="near-black"><path d="M12.5 22.6667C11.3458 22.6667 10.3458 22.4153 9.5 21.9127C8.65721 21.412 7.98339 20.7027 7.55521 19.8654C7.09997 18.9942 6.76672 18.0729 6.56354 17.1239C6.34796 16.0947 6.24294 15.0483 6.25 14C6.25 13.1699 6.30417 12.3764 6.41354 11.6176C6.52188 10.8598 6.72292 10.0894 7.01563 9.30748C7.30833 8.52555 7.68542 7.84763 8.14479 7.27274C8.62304 6.68378 9.24141 6.20438 9.95208 5.87163C10.6979 5.51244 11.5458 5.33333 12.5 5.33333C13.6542 5.33333 14.6542 5.58467 15.5 6.08733C16.3428 6.588 17.0166 7.29733 17.4448 8.13459C17.8969 8.99644 18.2271 9.9103 18.4365 10.8761C18.6448 11.841 18.75 12.883 18.75 14C18.75 14.8301 18.6958 15.6236 18.5865 16.3824C18.4699 17.1702 18.2639 17.9446 17.9719 18.6925C17.6698 19.4744 17.2948 20.1524 16.8427 20.7273C16.3906 21.3021 15.7927 21.7692 15.0479 22.1284C14.3031 22.4876 13.4542 22.6667 12.5 22.6667ZM14.7063 16.2945C15.304 15.6944 15.6365 14.864 15.625 14C15.625 13.1073 15.326 12.3425 14.7292 11.7055C14.1313 11.0685 13.3885 10.75 12.5 10.75C11.6115 10.75 10.8688 11.0685 10.2708 11.7055C9.68532 12.3123 9.36198 13.1405 9.375 14C9.375 14.8927 9.67396 15.6575 10.2708 16.2945C10.8688 16.9315 11.6115 17.25 12.5 17.25C13.3885 17.25 14.124 16.9315 14.7063 16.2945ZM12.5 27C19.4031 27 25 21.1792 25 14C25 6.82075 19.4031 1 12.5 1C5.59687 1 0 6.82075 0 14C0 21.1792 5.59687 27 12.5 27Z" fill="currentColor"></path></svg>
<a href="https://observablehq.com/d/8c2c588548870f79">View on Observable</a></p>
<p>Note the clustering of Brexiteers at the top of the plot, including Labour&rsquo;s Kate Hoey, the DUP, and Boris Johnson&rsquo;s cabinet.</p>
<p>At the bottom of the Conservative cloud are the more moderate MPs and Theresa May&rsquo;s cabinet. Former prime minister Ken Clarke is placed close to Sir Oliver Letwin (author of prominent amendments allowing the House to wrestle control from the government) and Dr Philip Lee, who defected to the Lib Dems.</p>
<p>Kit Malthouse, author of the <a href="https://www.theguardian.com/politics/2019/jan/29/the-malthouse-compromise-everything-you-need-to-know-brexit-vote">&ldquo;Malthouse compromise&rdquo;</a> which gathered support from both sides of the Conservative benches, is in the middle.</p>
<hr>
<h3 id="a-word-on-the-data">A word on the data</h3>
<p>The dataset is comprised of 238 votes, including amendments and draft bills, &ldquo;meaningful&rdquo; and &ldquo;indicative&rdquo; votes (on Theresa May&rsquo;s deal and on a range of freely-submitted, blue-sky-thinking options respectivelly), as well as procedural votes and motions (such as Sir Oliver Letwin&rsquo;s two successes at wrestling control of parliamentary agenda away from the executive branch).</p>
<p>These votes took place between September 2017 and September 2019, and I must thank the <a href="https://www.instituteforgovernment.org.uk/">Institute for Government</a>, who have provided the overwhelming majority of this research labelling Brexit-related votes from two years&rsquo; worth of votes.</p>
<p>As for the previous Reuters piece, I scraped the <a href="http://www.data.parliament.uk/">Parliament API</a> to obtain each vote cast by each MP in each House of Commons vote.</p>
<p>The <code>t-SNE</code> algorithm took into account how MPs voted (in favour or against a bill) and whether they voted at all (MPs are not bound to cast their vote, and some occasionally abstain).</p>
<p>These numerous variables were reduced by the algorithm to two dimensions for visualisations (<em>x</em> and <em>y</em>). Contrary to a principal component analysis (see <em>The Economist</em> piece below), it is not possible to say what <code>t-SNE</code> has <em>seen</em> (so to speak) in a dataset.</p>
<h3 id="acknowledgements">Acknowledgements</h3>
<ol>
<li><em>The Economist</em>&rsquo;s <a href="https://www.economist.com/graphic-detail/2019/03/29/mps-brexit-votes-reveal-myriad-divisions-among-the-tories">MP&rsquo;s Brexit votes reveal myriad divisions among the Tories</a>, based on 13 votes including the indicative and meaningful votes and on <a href="https://en.wikipedia.org/wiki/Principal_component_analysis">principal component analysis</a>.</li>
<li>The <a href="https://www.instituteforgovernment.org.uk/">Institute for Government</a>&rsquo;s continued excellent research and timely analysis of British politics.</li>
</ol>
<style>
.annotation-note-title {
font-family: sans-serif;
font-weight: 100;
font-sie: 6px;
}
</style>
<p><em>Thanks for keeping RSS alive!</em></p>]]></content:encoded><category>observable</category><category>d3</category><category>viz</category><enclosure url="https://basilesimon.fr/assets/tsne.png" type="image/jpeg"/><dc:description>Visualising 200 Brexit-related votes with machine learning</dc:description><dc:date>2019-10-06T00:00:00Z</dc:date><dc:rights>CC BY 4.0</dc:rights></item><item><title>Strava rides map in R</title><link>https://basilesimon.fr/blog/strava-rides-map-in-r?campaign=rss</link><pubDate>Wed, 02 Jan 2019 00:00:00 +0000</pubDate><author>Basile Simon</author><dc:creator>Basile Simon</dc:creator><guid>https://basilesimon.fr/blog/strava-rides-map-in-r/</guid><description>&lt;p>&lt;img src="assets/strava-map-final.jpeg" alt="">&lt;/p>
&lt;p>This is a Christmas present to myself to celebrate 10,000km of commuting on my bicycle: a lovely frame print of all my GPS traces on a home-made map of London. Here&amp;rsquo;s how I made it.&lt;/p>
&lt;p>&lt;em>This blog was contributed to &lt;a href="https://www.r-bloggers.com/">R Bloggers&lt;/a>&lt;/em>&lt;/p>
&lt;hr>
&lt;h2 id="step-one-getting-strava-data">Step one: getting Strava data&lt;/h2>
&lt;p>The process has become slightly convoluted in May 2018. In the past, it was possible to download a Strava archive which contained all activities as GPX; however, GDPR regulations &lt;a href="https://support.strava.com/hc/en-us/community/posts/360014914631-Activities-in-the-new-bulk-export-feature-have-meaningless-names-and-multiple-formats-">led to a change in bulk export format&lt;/a>.&lt;/p></description><content:encoded><![CDATA[<p><img src="assets/strava-map-final.jpeg" alt=""></p>
<p>This is a Christmas present to myself to celebrate 10,000km of commuting on my bicycle: a lovely frame print of all my GPS traces on a home-made map of London. Here&rsquo;s how I made it.</p>
<p><em>This blog was contributed to <a href="https://www.r-bloggers.com/">R Bloggers</a></em></p>
<hr>
<h2 id="step-one-getting-strava-data">Step one: getting Strava data</h2>
<p>The process has become slightly convoluted in May 2018. In the past, it was possible to download a Strava archive which contained all activities as GPX; however, GDPR regulations <a href="https://support.strava.com/hc/en-us/community/posts/360014914631-Activities-in-the-new-bulk-export-feature-have-meaningless-names-and-multiple-formats-">led to a change in bulk export format</a>.</p>
<p>Anyway: <a href="https://www.strava.com/athlete/delete_your_account">request your Strava archive</a>, wait for the email, download it.</p>
<p><code>activities.csv</code> gives us a list of activities&hellip; which we can then scrape from Strava.</p>
<pre tabindex="0"><code>$ cat activities/activities.csv | head -5
id,date,name,type,description,elapsed_time,distance,commute,gear,filename
1988225457,2018-11-27 19:11:32,Evening Ride,Ride,&#34;&#34;,1468,6075.0,true,1x1x8,activities/2125648250.fit.gz
1992478096,2018-11-29 10:02:58,Morning Ride,Ride,&#34;&#34;,1449,5869.0,true,1x1x8,activities/2130096306.fit.gz
1992478209,2018-11-29 23:04:16,Night Ride,Ride,&#34;&#34;,1166,5930.0,true,1x1x8,activities/2130096453.fit.gz
1992479540,2018-11-30 08:51:29,Morning Ride,Ride,&#34;&#34;,1427,6563.0,true,Michel le fixie,activities/2130097780.fit.gz
</code></pre><p>Clone <a href="https://github.com/hugovk/strava-tools">hugovk/strava-tools</a>, a set of Python tools to do automate interactions with Strava. There are some instructions at the top of <code>download_fit_as_gpx.py</code>.</p>
<p>Follow these before running <code>$ python download_fit_as_gpx.py</code></p>
<p>Some time later&hellip; here we are!</p>
<pre tabindex="0"><code>$ ls activities/activities | head -5
20160908-170525-Ride.gpx
20160909-080222-Ride.gpx
20160909-180740-Ride.gpx
20160912-081014-Ride.gpx
20160912-172611-Ride.gpx
</code></pre><hr>
<h2 id="step-two-ingesting-activities-in-r">Step two: Ingesting activities in R</h2>
<p>Install <a href="https://github.com/marcusvolz/strava"> marcusvolz/strava</a>, an excellent suite of R functions that help us load activities in a (big, big) dataframe.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">library</span>(devtools)
</span></span><span style="display:flex;"><span>devtools<span style="color:#000;font-weight:bold">::</span><span style="color:#900;font-weight:bold">install_github</span>(<span style="color:#d14">&#34;marcusvolz/strava&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">library</span>(strava)
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">library</span>(tidyverse)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># main ingestion method</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ACHTUNG: slow!</span>
</span></span><span style="display:flex;"><span>data  <span style="color:#000;font-weight:bold">&lt;-</span>  <span style="color:#900;font-weight:bold">process_data</span>(<span style="color:#d14">&#34;./activities/activities/&#34;</span>)
</span></span><span style="display:flex;"><span>data <span style="color:#000;font-weight:bold">%&gt;%</span> <span style="color:#900;font-weight:bold">head</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  id      lat      lon   ele                time dist_to_prev    cumdist time_diff_to_prev  cumtime
</span></span><span style="display:flex;"><span><span style="color:#099">1</span>  <span style="color:#099">1</span> <span style="color:#099">45.78514</span> <span style="color:#099">4.717282</span> <span style="color:#099">295.7</span> <span style="color:#099">2015-12-26</span> <span style="color:#099">11</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">21</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">48</span>  <span style="color:#099">0.000000000</span> <span style="color:#099">0.00000000</span>                 <span style="color:#099">0</span>        <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span><span style="color:#099">2</span>  <span style="color:#099">1</span> <span style="color:#099">45.78512</span> <span style="color:#099">4.717559</span> <span style="color:#099">295.3</span> <span style="color:#099">2015-12-26</span> <span style="color:#099">11</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">22</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">12</span>  <span style="color:#099">0.021643479</span> <span style="color:#099">0.02164348</span>                <span style="color:#099">24</span>       <span style="color:#099">24</span>
</span></span><span style="display:flex;"><span><span style="color:#099">3</span>  <span style="color:#099">1</span> <span style="color:#099">45.78512</span> <span style="color:#099">4.717573</span> <span style="color:#099">295.2</span> <span style="color:#099">2015-12-26</span> <span style="color:#099">11</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">22</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">13</span>  <span style="color:#099">0.001111138</span> <span style="color:#099">0.02275462</span>                 <span style="color:#099">1</span>       <span style="color:#099">25</span>
</span></span><span style="display:flex;"><span><span style="color:#099">4</span>  <span style="color:#099">1</span> <span style="color:#099">45.78512</span> <span style="color:#099">4.717583</span> <span style="color:#099">295.2</span> <span style="color:#099">2015-12-26</span> <span style="color:#099">11</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">22</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">17</span>  <span style="color:#099">0.000785528</span> <span style="color:#099">0.02354015</span>                 <span style="color:#099">4</span>       <span style="color:#099">29</span>
</span></span><span style="display:flex;"><span><span style="color:#099">5</span>  <span style="color:#099">1</span> <span style="color:#099">45.78509</span> <span style="color:#099">4.717684</span> <span style="color:#099">295.1</span> <span style="color:#099">2015-12-26</span> <span style="color:#099">11</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">22</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">38</span>  <span style="color:#099">0.008715879</span> <span style="color:#099">0.03225602</span>                <span style="color:#099">21</span>       <span style="color:#099">50</span>
</span></span><span style="display:flex;"><span><span style="color:#099">6</span>  <span style="color:#099">1</span> <span style="color:#099">45.78508</span> <span style="color:#099">4.717694</span> <span style="color:#099">295.1</span> <span style="color:#099">2015-12-26</span> <span style="color:#099">11</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">22</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">39</span>  <span style="color:#099">0.001181249</span> <span style="color:#099">0.03343727</span>                 <span style="color:#099">1</span>        <span style="color:#099">5</span>
</span></span></code></pre></div><hr>
<h2 id="step-three-visualising-our-activities">Step three: Visualising our activities</h2>
<p>We can piece together a simple plot (besides throwing a caveman-like <code>plot(data)</code>) limited to London:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">library</span>(ggplot2)
</span></span><span style="display:flex;"><span>theme_opts<span style="color:#000;font-weight:bold">&lt;-</span><span style="color:#900;font-weight:bold">list</span>(<span style="color:#900;font-weight:bold">theme</span>(panel.grid.minor <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
</span></span><span style="display:flex;"><span>  panel.background <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
</span></span><span style="display:flex;"><span>  plot.background <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
</span></span><span style="display:flex;"><span>  axis.line <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
</span></span><span style="display:flex;"><span>  axis.text.x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
</span></span><span style="display:flex;"><span>  axis.text.y <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
</span></span><span style="display:flex;"><span>  axis.ticks <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
</span></span><span style="display:flex;"><span>  axis.title.x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
</span></span><span style="display:flex;"><span>  axis.title.y <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
</span></span><span style="display:flex;"><span>  plot.title <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
</span></span><span style="display:flex;"><span>  panel.grid.major <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_line</span>(colour <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;transparent&#39;</span>),
</span></span><span style="display:flex;"><span>  legend.position <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;none&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">ggplot</span>(data,
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">aes</span>(lon, lat, group <span style="color:#000;font-weight:bold">=</span> id)) <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">geom_path</span>(colour<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;steelblue&#34;</span>,alpha <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.2</span>) <span style="color:#000;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">coord_map</span>(projection <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;mercator&#34;</span>, 
</span></span><span style="display:flex;"><span>    xlim <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">-0.41</span>, <span style="color:#099">0.08</span>), 
</span></span><span style="display:flex;"><span>    ylim <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">51.42</span>, <span style="color:#099">51.73</span>), clip <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;on&#34;</span>) <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>  theme_opts
</span></span></code></pre></div><p><img src="assets/strava-map-1.png" alt=""></p>
<p>Obviously we are going to need some geographical landmarks to get our bearings. <a href="https://github.com/geotheory/londonShapefiles/">geotheory/londonShapefiles</a> is one of the simplest and quickest ways to get London boundaries loaded in - and that includes the river Thames.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">library</span>(devtools)
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">install_github</span>(<span style="color:#d14">&#34;geotheory/londonShapefiles&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">library</span>(<span style="color:#d14">&#34;londonShapefiles&#34;</span>)
</span></span><span style="display:flex;"><span>thames <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">load_thames</span>()
</span></span><span style="display:flex;"><span>thames.proj <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">spTransform</span>(thames, <span style="color:#900;font-weight:bold">CRS</span>(<span style="color:#d14">&#34;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs&#34;</span>))
</span></span><span style="display:flex;"><span>thames.df <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">fortify</span>(thames.proj)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">ggplot</span>() <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">geom_polygon</span>(thames.df,
</span></span><span style="display:flex;"><span>   mapping<span style="color:#000;font-weight:bold">=</span><span style="color:#900;font-weight:bold">aes</span>(long, lat, group <span style="color:#000;font-weight:bold">=</span> group,
</span></span><span style="display:flex;"><span>    fill <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">I</span>(<span style="color:#d14">&#34;skyblue&#34;</span>)), alpha <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.4</span>) <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">geom_path</span>(data,
</span></span><span style="display:flex;"><span>    mapping<span style="color:#000;font-weight:bold">=</span><span style="color:#900;font-weight:bold">aes</span>(lon, lat, group <span style="color:#000;font-weight:bold">=</span> id,
</span></span><span style="display:flex;"><span>    alpha <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.9</span>, color <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">I</span>(<span style="color:#d14">&#34;tomato&#34;</span>)),
</span></span><span style="display:flex;"><span>    size<span style="color:#000;font-weight:bold">=</span><span style="color:#099">1</span><span style="color:#000;font-weight:bold">/</span><span style="color:#099">3</span>) <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">coord_map</span>(projection <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;mercator&#34;</span>,
</span></span><span style="display:flex;"><span>    xlim <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">-0.41</span>, <span style="color:#099">0.08</span>),
</span></span><span style="display:flex;"><span>    ylim <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">51.42</span>, <span style="color:#099">51.73</span>)) <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>  theme_opts
</span></span></code></pre></div><p><img src="assets/strava-map-2.png" alt=""></p>
<p>But behold, we can also get data straight from Open Street Map thanks to <a href="https://cran.r-project.org/web/packages/osmdata/vignettes/osmdata.html">osmdata</a>. The syntax is relatively concise and OSM&rsquo;s web interface allows you to query features directly from there:</p>
<p><img src="https://i.gyazo.com/4f3440eea455f9f94ce42e46444cb838.gif" alt=""></p>
<p>In our example, we grab all the parks in London and them use <code>geom_sf()</code> to represent both the <code>polygons</code> and <code>multipolygons</code> (the <code>osmdata</code>object <a href="https://cran.r-project.org/web/packages/osmdata/vignettes/osmdata.html#3_the_osmdata_object">has plenty inside it</a>). We need both polygons and multipolygons because, according to the OSM wiki:</p>
<blockquote>
<p>Any area that is more complex than that (e.g., because its outline consists of several ways joined together, or because the area consists of multiple disjunct parts, or has holes) requires a <em>multipolygon</em> relation.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">library</span>(osmdata)
</span></span><span style="display:flex;"><span>parks2 <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">opq</span>(bbox <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">-0.41</span>, <span style="color:#099">51.42</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#099">0.08</span>, <span style="color:#099">51.73</span>)) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">add_osm_feature</span>(key <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;leisure&#39;</span>,
</span></span><span style="display:flex;"><span>    value <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;park&#34;</span>) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">osmdata_sf</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">ggplot</span>() <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">geom_polygon</span>(thames.df,
</span></span><span style="display:flex;"><span>   mapping<span style="color:#000;font-weight:bold">=</span><span style="color:#900;font-weight:bold">aes</span>(long, lat, group <span style="color:#000;font-weight:bold">=</span> group,
</span></span><span style="display:flex;"><span>    fill <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">I</span>(<span style="color:#d14">&#34;skyblue&#34;</span>)), alpha <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.4</span>) <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">geom_sf</span>(parks2<span style="color:#000;font-weight:bold">$</span>osm_polygons,
</span></span><span style="display:flex;"><span>   mapping<span style="color:#000;font-weight:bold">=</span><span style="color:#900;font-weight:bold">aes</span>(fill <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">I</span>(<span style="color:#d14">&#34;springgreen4&#34;</span>),
</span></span><span style="display:flex;"><span>    color <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">I</span>(<span style="color:#d14">&#34;transparent&#34;</span>)),
</span></span><span style="display:flex;"><span>    alpha <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.4</span>) <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">geom_sf</span>(parks2<span style="color:#000;font-weight:bold">$</span>osm_multipolygons,
</span></span><span style="display:flex;"><span>   mapping<span style="color:#000;font-weight:bold">=</span><span style="color:#900;font-weight:bold">aes</span>(fill <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">I</span>(<span style="color:#d14">&#34;springgreen4&#34;</span>),
</span></span><span style="display:flex;"><span>   color <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">I</span>(<span style="color:#d14">&#34;transparent&#34;</span>)), alpha <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.4</span>) <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">geom_path</span>(data,
</span></span><span style="display:flex;"><span>  mapping<span style="color:#000;font-weight:bold">=</span><span style="color:#900;font-weight:bold">aes</span>(lon, lat, group <span style="color:#000;font-weight:bold">=</span> id,
</span></span><span style="display:flex;"><span>   alpha <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.9</span>, color <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">I</span>(<span style="color:#d14">&#34;tomato&#34;</span>)),
</span></span><span style="display:flex;"><span>   size<span style="color:#000;font-weight:bold">=</span><span style="color:#099">1</span><span style="color:#000;font-weight:bold">/</span><span style="color:#099">3</span>) <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">coord_sf</span>(xlim <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">-0.41</span>, <span style="color:#099">0.08</span>),
</span></span><span style="display:flex;"><span>           ylim <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">51.42</span>, <span style="color:#099">51.73</span>)) <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>  theme_opts
</span></span></code></pre></div><p><img src="assets/strava-map-3.png" alt=""></p>
<hr>
<p>Well, we&rsquo;re almost there. For this first draft I stopped at the map above, exported an SVG and sent that to the lab for printing.</p>
<p>There is no limit to how much you can play with this data. One thing that really struck me was how imprecise my GPS tracking devices were in the City of London (despite being prosumer equipment). Below is a representation of one year of data, on which I&rsquo;ve overlaid the OSM paths corresponding to the streets around Bishopsgate, Cheapside, Monument, Cannon Street, Aldgate, Smithfields, London Bridge and Blackfriars.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>streets <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">opq</span>(bbox <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">-0.21</span>, <span style="color:#099">51.47</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#099">0.05</span>, <span style="color:#099">51.61</span>)) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">add_osm_feature</span>(key <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;highway&#39;</span>,
</span></span><span style="display:flex;"><span>  value <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;primary&#34;</span>) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">osmdata_sf</span>()
</span></span><span style="display:flex;"><span>streets2 <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">opq</span>(bbox <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">-0.21</span>, <span style="color:#099">51.47</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#099">0.05</span>, <span style="color:#099">51.61</span>)) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">add_osm_feature</span>(key <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;highway&#39;</span>,
</span></span><span style="display:flex;"><span>  value <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;secondary&#34;</span>) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">osmdata_sf</span>()
</span></span><span style="display:flex;"><span>streets3 <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">opq</span>(bbox <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">-0.21</span>, <span style="color:#099">51.47</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#099">0.05</span>, <span style="color:#099">51.61</span>)) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">add_osm_feature</span>(key <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;highway&#39;</span>,
</span></span><span style="display:flex;"><span>  value <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;tertiary&#34;</span>) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">osmdata_sf</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">+</span> <span style="color:#900;font-weight:bold">geom_sf</span>(streets<span style="color:#000;font-weight:bold">$</span>osm_lines,
</span></span><span style="display:flex;"><span>   mapping<span style="color:#000;font-weight:bold">=</span><span style="color:#900;font-weight:bold">aes</span>(fill <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">I</span>(<span style="color:#d14">&#34;transparent&#34;</span>),
</span></span><span style="display:flex;"><span>   color <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">I</span>(<span style="color:#d14">&#34;darkgray&#34;</span>)), size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.5</span>) <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">geom_sf</span>(streets2<span style="color:#000;font-weight:bold">$</span>osm_lines,
</span></span><span style="display:flex;"><span>   mapping<span style="color:#000;font-weight:bold">=</span><span style="color:#900;font-weight:bold">aes</span>(fill <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">I</span>(<span style="color:#d14">&#34;transparent&#34;</span>),
</span></span><span style="display:flex;"><span>   color <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">I</span>(<span style="color:#d14">&#34;darkgray&#34;</span>)), size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.3</span>) <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">geom_sf</span>(streets3<span style="color:#000;font-weight:bold">$</span>osm_lines,
</span></span><span style="display:flex;"><span>   mapping<span style="color:#000;font-weight:bold">=</span><span style="color:#900;font-weight:bold">aes</span>(fill <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">I</span>(<span style="color:#d14">&#34;transparent&#34;</span>),
</span></span><span style="display:flex;"><span>   color <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">I</span>(<span style="color:#d14">&#34;darkgray&#34;</span>)), size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.1</span>) 
</span></span></code></pre></div><p><img src="assets/strava-map-4.png" alt=""></p>
<p><em>Thanks for keeping RSS alive!</em></p>]]></content:encoded><category>r</category><category>viz</category><enclosure url="https://blog.basilesimon.fr/assets/strava-map-final.jpeg" type="image/jpeg"/><dc:description>Scraping Strava to map 10,000km of cycling with Python, R and ggplot</dc:description><dc:date>2019-01-02T00:00:00Z</dc:date><dc:rights>CC BY 4.0</dc:rights></item><item><title>Mapping storms in R</title><link>https://basilesimon.fr/blog/storms-map-in-r?campaign=rss</link><pubDate>Wed, 05 Sep 2018 00:00:00 +0000</pubDate><author>Basile Simon</author><dc:creator>Basile Simon</dc:creator><guid>https://basilesimon.fr/blog/storms-map-in-r/</guid><description>&lt;p>&lt;img src="https://basilesimon.fr/assets/storms_final.png" alt="">&lt;/p>
&lt;p>Japan is currently counting the cost of the strongest typhoon to hit its coasts in 25 years. The death toll currently stands at nine, and hundreds were injured.&lt;/p>
&lt;p>The north western Pacific basin sees many storms, and meteorology agencies release loads of data about climate events such as these. For this example, we are going to use the work of the National Oceanic and Atmospheric Administration, which releases datasets known as &lt;a href="https://www.ncdc.noaa.gov/ibtracs/">International Best Track Archive for Climate Stewardship&lt;/a>.&lt;/p></description><content:encoded><![CDATA[<p><img src="/assets/storms_final.png" alt=""></p>
<p>Japan is currently counting the cost of the strongest typhoon to hit its coasts in 25 years. The death toll currently stands at nine, and hundreds were injured.</p>
<p>The north western Pacific basin sees many storms, and meteorology agencies release loads of data about climate events such as these. For this example, we are going to use the work of the National Oceanic and Atmospheric Administration, which releases datasets known as <a href="https://www.ncdc.noaa.gov/ibtracs/">International Best Track Archive for Climate Stewardship</a>.</p>
<p>Head to &ldquo;data access&rdquo; and make your way to the <a href="ftp://eclipse.ncdc.noaa.gov/pub/ibtracs/v03r10/all/csv/basin">CSV release</a> for each oceanic basin. We need the western Pacific one.</p>
<p><em>This blog was contributed to <a href="https://www.r-bloggers.com/">R Bloggers</a></em></p>
<hr>
<h1 id="preparing-data-and-basic-mapping">Preparing data and basic mapping</h1>
<p>Now let&rsquo;s load our packages. No need for <code>rgdal</code>, we&rsquo;ll do everything in <code>ggplot</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">library</span>(ggplot2)
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">library</span>(dplyr)
</span></span></code></pre></div><p>We read our data source in and just clean things up a bit.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># data source</span>
</span></span><span style="display:flex;"><span>basin <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">read.csv</span>(<span style="color:#d14">&#39;Basin.WP.ibtracs_all.v03r10.csv&#39;</span>,
</span></span><span style="display:flex;"><span>                  skip <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>, stringsAsFactors <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">FALSE</span>)
</span></span><span style="display:flex;"><span>basin <span style="color:#000;font-weight:bold">&lt;-</span> basin[<span style="color:#099">-1</span>, ] <span style="color:#998;font-style:italic"># first column is garbled, disegard</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># cleaner columns</span>
</span></span><span style="display:flex;"><span>basin<span style="color:#000;font-weight:bold">$</span>Season <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">as.numeric</span>(basin<span style="color:#000;font-weight:bold">$</span>Season)
</span></span><span style="display:flex;"><span>basin<span style="color:#000;font-weight:bold">$</span>Latitude <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">as.numeric</span>(<span style="color:#900;font-weight:bold">gsub</span>(<span style="color:#d14">&#34;^ &#34;</span>, <span style="color:#d14">&#34;&#34;</span>, basin<span style="color:#000;font-weight:bold">$</span>Latitude))
</span></span><span style="display:flex;"><span>basin<span style="color:#000;font-weight:bold">$</span>Longitude <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">as.numeric</span>(<span style="color:#900;font-weight:bold">gsub</span>(<span style="color:#d14">&#34;^ &#34;</span>, <span style="color:#d14">&#34;&#34;</span>, basin<span style="color:#000;font-weight:bold">$</span>Longitude))
</span></span><span style="display:flex;"><span>basin<span style="color:#000;font-weight:bold">$</span>Wind.WMO. <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">as.numeric</span>(<span style="color:#900;font-weight:bold">gsub</span>(<span style="color:#d14">&#34;^ &#34;</span>, <span style="color:#d14">&#34;&#34;</span>, basin<span style="color:#000;font-weight:bold">$</span>Wind.WMO.))
</span></span><span style="display:flex;"><span>basin<span style="color:#000;font-weight:bold">$</span>Name <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">as.factor</span>(basin<span style="color:#000;font-weight:bold">$</span>Name)
</span></span></code></pre></div><p>For the purpose of this exercise, we want to visualise 2000 to 2017 data. Sadly our dataset does not contain data for 2018 yet&hellip; Please excuse my poor chaining of <code>filter()</code> methods &ndash; I am but a journalist after all.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># extract 2000 to 2017 data</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># also remove some weird datapoints</span>
</span></span><span style="display:flex;"><span>substorms <span style="color:#000;font-weight:bold">&lt;-</span> basin <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">filter</span>(Season <span style="color:#000;font-weight:bold">%in%</span> <span style="color:#099">2000</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">2017</span>) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">filter</span>(<span style="color:#000;font-weight:bold">!</span>Name <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#34;NOT NAMED&#34;</span>) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">filter</span>(<span style="color:#000;font-weight:bold">!</span>Latitude <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">-999</span>) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">filter</span>(<span style="color:#000;font-weight:bold">!</span>Longitude <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">-999</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>substorms<span style="color:#000;font-weight:bold">$</span>ID <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">as.factor</span>(<span style="color:#900;font-weight:bold">paste</span>(substorms<span style="color:#000;font-weight:bold">$</span>Name, substorms<span style="color:#000;font-weight:bold">$</span>Season, 
</span></span><span style="display:flex;"><span>                                sep <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#d14">&#34;.&#34;</span>))
</span></span></code></pre></div><p>We&rsquo;re going to rely on <code>map_data(&quot;world&quot;)</code> for our base map. In <code>ggplot</code> world that&rsquo;s how we build that up:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># world map</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">ggplot</span>() <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">geom_polygon</span>(data <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">map_data</span>(<span style="color:#d14">&#34;world&#34;</span>),
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">aes</span>(x <span style="color:#000;font-weight:bold">=</span> long, y <span style="color:#000;font-weight:bold">=</span> lat, group <span style="color:#000;font-weight:bold">=</span> group))
</span></span></code></pre></div><p><img src="assets/worldmap.png" alt=""></p>
<p>Our storms will be a set of <code>geom_path()</code> which lat/long coordinates we&rsquo;ve passed in at the top.</p>
<p>The object of our study here is a series of tracks followed by each storm. Representing tracks as lines feels natural.
As our data comes as a list of points, we need to group together all the points that represent one storm. Were we studying say, the winds, we would run something like this, grouping our points by storm unique ID.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>substorms <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">group_by</span>(ID) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">summarise</span>(average_winds <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">mean</span>(Wind.WMO.)) <span style="color:#000;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">arrange</span>(<span style="color:#900;font-weight:bold">desc</span>(average_winds))
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>A tibble<span style="color:#000;font-weight:bold">:</span> <span style="color:#099">401</span> x <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>   ID               average_winds
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">&lt;</span>fct<span style="color:#000;font-weight:bold">&gt;</span>                    <span style="color:#000;font-weight:bold">&lt;</span>dbl<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span> <span style="color:#099">1</span> JELAWAT <span style="color:#099">2012</span> .            <span style="color:#099">71.4</span>
</span></span><span style="display:flex;"><span> <span style="color:#099">2</span> HAIYAN <span style="color:#099">2013</span> .             <span style="color:#099">70.5</span>
</span></span><span style="display:flex;"><span> <span style="color:#099">3</span> CHOI<span style="color:#000;font-weight:bold">-</span>WAN <span style="color:#099">2009</span> .           <span style="color:#099">69.2</span>
</span></span><span style="display:flex;"><span> <span style="color:#099">4</span> FENGSHEN <span style="color:#099">2002</span> .           <span style="color:#099">68.8</span>
</span></span><span style="display:flex;"><span> <span style="color:#099">5</span> MEGI <span style="color:#099">2010</span> .               <span style="color:#099">68.7</span>
</span></span></code></pre></div><p>We can do the same inside <code>ggplot</code> by passing <code>aes(group = ID)</code>. Here is our result:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#900;font-weight:bold">ggplot</span>(substorms, <span style="color:#900;font-weight:bold">aes</span>(x <span style="color:#000;font-weight:bold">=</span> Longitude, y <span style="color:#000;font-weight:bold">=</span> Latitude, group <span style="color:#000;font-weight:bold">=</span> ID)) <span style="color:#000;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">geom_polygon</span>(data <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">map_data</span>(<span style="color:#d14">&#34;world&#34;</span>), <span style="color:#900;font-weight:bold">aes</span>(x <span style="color:#000;font-weight:bold">=</span> long, y <span style="color:#000;font-weight:bold">=</span> lat, group <span style="color:#000;font-weight:bold">=</span> group)) <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">geom_path</span>(data <span style="color:#000;font-weight:bold">=</span> substorms, <span style="color:#900;font-weight:bold">aes</span>(group <span style="color:#000;font-weight:bold">=</span> ID))
</span></span></code></pre></div><p><img src="assets/worldmap1.png" alt=""></p>
<p>Now let&rsquo;s add some styles. We also need to limit our map coordinates to Asia and the Pacific, and <em>voil√†</em>.</p>
<p>Edit December 2018: In order to prevent the odd clipping and horizontal lines from <code>coord_map()</code>, we need to clip the world map polygons ahead of rendering:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>wm <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">map_data</span>(<span style="color:#d14">&#34;world&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">library</span>(<span style="color:#d14">&#34;PBSmapping&#34;</span>)
</span></span><span style="display:flex;"><span>data.table<span style="color:#000;font-weight:bold">::</span><span style="color:#900;font-weight:bold">setnames</span>(wm, <span style="color:#900;font-weight:bold">c</span>(<span style="color:#d14">&#34;X&#34;</span>,<span style="color:#d14">&#34;Y&#34;</span>,<span style="color:#d14">&#34;PID&#34;</span>,<span style="color:#d14">&#34;POS&#34;</span>,<span style="color:#d14">&#34;region&#34;</span>,<span style="color:#d14">&#34;subregion&#34;</span>))
</span></span><span style="display:flex;"><span>worldmap <span style="color:#000;font-weight:bold">&lt;-</span> <span style="color:#900;font-weight:bold">clipPolys</span>(wm, xlim<span style="color:#000;font-weight:bold">=</span><span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">60</span>,<span style="color:#099">180</span>),ylim<span style="color:#000;font-weight:bold">=</span><span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">-20</span>, <span style="color:#099">60</span>), keepExtra<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">TRUE</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>theme_opts<span style="color:#000;font-weight:bold">&lt;-</span><span style="color:#900;font-weight:bold">list</span>(<span style="color:#900;font-weight:bold">theme</span>(panel.grid.minor <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
</span></span><span style="display:flex;"><span>                       panel.grid.major <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
</span></span><span style="display:flex;"><span>                       panel.background <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
</span></span><span style="display:flex;"><span>                       plot.background <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
</span></span><span style="display:flex;"><span>                       axis.line <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
</span></span><span style="display:flex;"><span>                       axis.text.x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
</span></span><span style="display:flex;"><span>                       axis.text.y <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
</span></span><span style="display:flex;"><span>                       axis.ticks <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
</span></span><span style="display:flex;"><span>                       axis.title.x <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
</span></span><span style="display:flex;"><span>                       axis.title.y <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>(),
</span></span><span style="display:flex;"><span>                       plot.title <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">element_blank</span>()))
</span></span><span style="display:flex;"><span>                       
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">ggplot</span>(substorms, <span style="color:#900;font-weight:bold">aes</span>(x <span style="color:#000;font-weight:bold">=</span> Longitude, y <span style="color:#000;font-weight:bold">=</span> Latitude, group <span style="color:#000;font-weight:bold">=</span> ID)) <span style="color:#000;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">geom_polygon</span>(data <span style="color:#000;font-weight:bold">=</span> worldmap, <span style="color:#900;font-weight:bold">aes</span>(x <span style="color:#000;font-weight:bold">=</span> X, y <span style="color:#000;font-weight:bold">=</span> Y, group <span style="color:#000;font-weight:bold">=</span> PID), 
</span></span><span style="display:flex;"><span>               fill <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;whitesmoke&#34;</span>, colour <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;gray10&#34;</span>, size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.2</span>) <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">geom_path</span>(data <span style="color:#000;font-weight:bold">=</span> substorms, <span style="color:#900;font-weight:bold">aes</span>(group <span style="color:#000;font-weight:bold">=</span> ID), 
</span></span><span style="display:flex;"><span>            alpha <span style="color:#000;font-weight:bold">=</span> substorms<span style="color:#000;font-weight:bold">$</span>Wind.WMO.<span style="color:#000;font-weight:bold">/</span><span style="color:#099">500</span>, size <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.8</span>,
</span></span><span style="display:flex;"><span>            color <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;red&#34;</span>) <span style="color:#000;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">coord_map</span>(xlim <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">60</span>,<span style="color:#099">180</span>), ylim <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">c</span>(<span style="color:#099">-20</span>, <span style="color:#099">60</span>)) <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">labs</span>(x <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;</span>, y <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;</span>, colour <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Wind \n(knots)&#34;</span>) <span style="color:#000;font-weight:bold">+</span> theme_opts
</span></span></code></pre></div><p><img src="assets/storms_all.png" alt=""></p>
<hr>
<h1 id="storms-by-year-and-month">Storms by year and month</h1>
<p>Now who doesn&rsquo;t like a good facetting? That&rsquo;s how I fell in love with <code>ggplot</code> in the first place. We can easily extract dates from our data in order to prepare for different facetting opportunities.</p>
<p>Facetting by year allows us to visually (and relatively unreliably) compare years against each other. Doing the same operation by month will show when do typhoons mostly hit in the Pacific. (Edit December 2018: we now use <code>lubridate</code> functions to do so.)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># extract month and year for facetting later</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">library</span>(lubridate)
</span></span><span style="display:flex;"><span>substorms <span style="color:#000;font-weight:bold">&lt;-</span> substorms <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">mutate</span>(Month <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">month</span>(<span style="color:#900;font-weight:bold">as.Date</span>(ISO_time))) <span style="color:#000;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">mutate</span>(Year <span style="color:#000;font-weight:bold">=</span> <span style="color:#900;font-weight:bold">year</span>(<span style="color:#900;font-weight:bold">as.Date</span>(ISO_time)))
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">+</span> <span style="color:#900;font-weight:bold">facet_wrap</span>(<span style="color:#000;font-weight:bold">~</span>Year)
</span></span></code></pre></div><p><img src="assets/storms_years.png" alt=""></p>
<p>And finally, by month (with the types done up in Illustrator):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">+</span> <span style="color:#900;font-weight:bold">facet_wrap</span>(<span style="color:#000;font-weight:bold">~</span>Month)
</span></span></code></pre></div><p><img src="assets/storms_final.png" alt=""></p>
<p><em>Thanks for keeping RSS alive!</em></p>]]></content:encoded><category>r</category><category>viz</category><enclosure url="https://basilesimon.fr/assets/storms_final.png" type="image/jpeg"/><dc:description>How to map 10 years of storms in the Pacific, with R and ggplot</dc:description><dc:date>2018-09-05T00:00:00Z</dc:date><dc:rights>CC BY 4.0</dc:rights></item></channel></rss>