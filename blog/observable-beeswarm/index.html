<!doctype html><html lang=en-gb><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://basilesimon.fr/images/favicon.png><title>A beeswarm layout in Observable -- on deadline</title>
<meta name=title content="A beeswarm layout in Observable -- on deadline"><meta name=description content="A step-by-step walkthrough of a beeswarm layout I produced as an alternative a bar chart"><meta name=keywords content="observable,d3,viz,"><meta property="og:url" content="https://basilesimon.fr/blog/observable-beeswarm/"><meta property="og:site_name" content="ðŸ‘‹ hi, Iâ€™m basile"><meta property="og:title" content="A beeswarm layout in Observable -- on deadline"><meta property="og:description" content="A step-by-step walkthrough of a beeswarm layout I produced as an alternative a bar chart"><meta property="og:locale" content="en_gb"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2020-10-21T00:00:00+00:00"><meta property="article:modified_time" content="2020-10-21T00:00:00+00:00"><meta property="article:tag" content="Observable"><meta property="article:tag" content="D3"><meta property="article:tag" content="Viz"><meta property="og:image" content="https://basilesimon.fr/assets/author.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://basilesimon.fr/assets/author.jpg"><meta name=twitter:title content="A beeswarm layout in Observable -- on deadline"><meta name=twitter:description content="A step-by-step walkthrough of a beeswarm layout I produced as an alternative a bar chart"><meta itemprop=name content="A beeswarm layout in Observable -- on deadline"><meta itemprop=description content="A step-by-step walkthrough of a beeswarm layout I produced as an alternative a bar chart"><meta itemprop=datePublished content="2020-10-21T00:00:00+00:00"><meta itemprop=dateModified content="2020-10-21T00:00:00+00:00"><meta itemprop=wordCount content="351"><meta itemprop=image content="https://basilesimon.fr/assets/author.jpg"><meta itemprop=keywords content="Observable,D3,Viz"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:720px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}div.highlight code{background-color:unset;color:initial}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style><base href=https://basilesimon.fr/><link rel=stylesheet href=main.css><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono&display=swap" rel=stylesheet><link rel=alternate type=application/rss+xml href=https://basilesimon.fr/blog/index.xml title="ðŸ‘‹ hi, Iâ€™m basile"><link rel=canonical href=https://basilesimon.fr/blog/observable-beeswarm/><meta property="og:image" content="https://basilesimon.fr/assets/beeswarm-obs.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@basilesimon"><meta name=twitter:creator content="@basilesimon"><meta name=twitter:image content="https://basilesimon.fr/assets/beeswarm-obs.png"><meta name=author content="Basile Simon"><meta name=robots content="max-image-preview:large"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"A beeswarm layout in Observable -- on deadline","url":"https://basilesimon.fr/blog/observable-beeswarm/","datePublished":"2020-10-21T00:00:00Z","dateModified":"2020-10-21T00:00:00Z","description":"A step-by-step walkthrough of a beeswarm layout I produced as an alternative a bar chart","image":{"@type":"ImageObject","url":"https://basilesimon.fr/assets/beeswarm-obs.png","width":1200,"height":630},"keywords":"observable, d3, viz","wordCount":351,"author":{"@type":"Person","@id":"https:\/\/basilesimon.fr\/#person","name":"Basile Simon","url":"https://basilesimon.fr/","image":{"@type":"ImageObject","url":"https:\/\/basilesimon.fr\/\/assets\/author.jpg"},"jobTitle":"Research Scholar","affiliation":[{"@type":"Organization","name":"Starling Lab for Data Integrity","url":"https://starlinglab.org/","parentOrganization":[{"@type":"CollegeOrUniversity","name":"Stanford University","url":"https://www.stanford.edu/"},{"@type":"CollegeOrUniversity","name":"University of Southern California","url":"https://www.usc.edu/"}]}],"alumniOf":[{"@type":"Organization","name":"BBC News Labs"},{"@type":"Organization","name":"Reuters"},{"@type":"Organization","name":"The Times and The Sunday Times"}],"sameAs":["https:\/\/vis.social\/@basilesimon","https:\/\/github.com\/basilesimon","https:\/\/bsky.app\/profile\/basilesimon.bsky.social","https://twitter.com/basilesimon"]},"publisher":{"@type":"Person","@id":"https:\/\/basilesimon.fr\/#person"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://basilesimon.fr/blog/observable-beeswarm/"},"inLanguage":"en-GB","copyrightHolder":{"@type":"Person","@id":"https:\/\/basilesimon.fr\/#person"},"copyrightYear":"2020","license":"https://creativecommons.org/licenses/by/4.0/"}</script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "dbdcfc9895e340f8a4e734b917d51280"}'></script><script data-goatcounter=https://deptoolkit.goatcounter.com/count async src=//gc.zgo.at/count.js></script></head><body><header><a href=/ class=title><h2>ðŸ‘‹ hi, Iâ€™m basile</h2></a><nav><a href=/>Home</a>
<a href=/blog>Blog</a></nav></header><main><article class=single><h1>A beeswarm layout in Observable -- on deadline</h1><p><i><time datetime=2020-10-21 pubdate>21 Oct, 2020</time></i></p><div class=content><p><img src=assets/beeswarm-obs.png alt></p><p>I recently had to complete a technical test for a role I&rsquo;m interested in.</p><p>The task: from <a href=https://www.globalwitness.org/en/campaigns/oil-gas-and-mining/chevron-stop-funding-racism/>a story out of the Global Witness website</a>, can you come up with an alternative visualisation? <strong>You&rsquo;ve got two hours.</strong></p><p>As there were no embed constraints, I figured there was no point in faffing with boilerplate code and scaffolds, so I went down the Observable route to put a chart together.</p><p>Here&rsquo;s what we need scales-wise:</p><ul><li>On the y axis, the amount of the individual donations range from 0 to $10,000 &ndash; we&rsquo;ll use a linear scale which domain is mapped to this extent;</li><li>On the x axis, we&rsquo;ve got two categories: the donations that pass the NAACP criteria, and those that don&rsquo;t. We cue an ordinal scale which domain are these values;</li><li>A simple colour scale;</li></ul><hr><p>But as donation amounts overlap each other, so do our circles. Here they are, with a small increasing offset to show this banding effect:</p><p><img src=assets/beeswarm-overlap.png alt></p><p>Comes the force layout to the rescue, adding some simulated entropy to the x/y coordinates of our circles and allowing us to appreciate the difference in scale between the two columns.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#000;font-weight:700>const</span> simulation <span style=color:#000;font-weight:700>=</span> d3
</span></span><span style=display:flex><span>  .forceSimulation(data)
</span></span><span style=display:flex><span>  .force(<span style=color:#d14>&#39;x&#39;</span>, d3.forceX(d =&gt; x(d.category)).strength(<span style=color:#099>0.2</span>))
</span></span><span style=display:flex><span>  .force(<span style=color:#d14>&#39;y&#39;</span>, d3.forceY(d =&gt; y(<span style=color:#000;font-weight:700>+</span>d.donationUSD)).strength(<span style=color:#099>1</span>))
</span></span><span style=display:flex><span>  .force(<span style=color:#d14>&#39;collide&#39;</span>, d3.forceCollide(d =&gt; size(<span style=color:#0086b3>Math</span>.sqrt(<span style=color:#000;font-weight:700>+</span>d.donationUSD))))
</span></span><span style=display:flex><span>  .alphaDecay(<span style=color:#099>0</span>)
</span></span><span style=display:flex><span>  .alpha(<span style=color:#099>0.3</span>)
</span></span><span style=display:flex><span>  .stop();
</span></span></code></pre></div><p>We apply three forces to our simulation:</p><ul><li>One <strong>on the x axis</strong>, so our circles bucket into our two categories. We specify a weak <code>.strength()</code> so they spread out horizontally rather than vertically (and thus are more truthful to the precise donation amounts);</li><li>One <strong>on the y axis</strong>, where in this case the <code>.strength()</code> is far greater to squeeze them further, as seen above;</li><li>A <strong>collision force</strong> which repels the circles from each other, so as to spread them apart.</li></ul><p>Here they are, showing the influence of x and y&rsquo;s <code>.strength()</code>:</p><video autoplay loop muted playsinline>
<source src=assets/beeswarm.mp4 type=video/mp4></video><p>Did I say I had two hours to do this? I had to skimp on the annotations, which I&rsquo;ve positioned manually and quite roughly as <text>elements.</p><hr><p>Read more:</p><ul><li><a href=https://observablehq.com/@rospearce/beeswarm>@rospearce&rsquo;s layout greatly helped</a></li><li>There appears to be an actual npm module to produce such layouts: <a href=https://github.com/Kcnarf/d3-beeswarm>d3-beeswarm</a></li><li><a href=https://www.chartfleau.com/tutorials/d3swarm/>A rather complete tutorial from @chartfleau</a></li></ul></div><p><a href=https://basilesimon.fr/tags/observable/>#Observable</a>
<a href=https://basilesimon.fr/tags/d3/>#D3</a>
<a href=https://basilesimon.fr/tags/viz/>#Viz</a></p><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https:\/\/basilesimon.fr\/"},{"@type":"ListItem","position":2,"name":"Blog","item":"https:\/\/basilesimon.fr\/blog/"},{"@type":"ListItem","position":3,"name":"A beeswarm layout in Observable -- on deadline","item":"https:\/\/basilesimon.fr\/blog\/observable-beeswarm\/"}]}</script></article></main><footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo Ê•â€¢á´¥â€¢Ê” Bear</a></footer></body></html>