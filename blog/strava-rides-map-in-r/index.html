<!doctype html><html lang=en-gb><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://basilesimon.fr/images/favicon.png><title>Strava rides map in R</title>
<meta name=title content="Strava rides map in R"><meta name=description content="Scraping Strava to map 10,000km of cycling with Python, R and ggplot"><meta name=keywords content="r,viz,"><meta property="og:url" content="https://basilesimon.fr/blog/strava-rides-map-in-r/"><meta property="og:site_name" content="ðŸ‘‹ hi, Iâ€™m basile"><meta property="og:title" content="Strava rides map in R"><meta property="og:description" content="Scraping Strava to map 10,000km of cycling with Python, R and ggplot"><meta property="og:locale" content="en_gb"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2019-01-02T00:00:00+00:00"><meta property="article:modified_time" content="2019-01-02T00:00:00+00:00"><meta property="article:tag" content="R"><meta property="article:tag" content="Viz"><meta property="og:image" content="https://basilesimon.fr/assets/author.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://basilesimon.fr/assets/author.jpg"><meta name=twitter:title content="Strava rides map in R"><meta name=twitter:description content="Scraping Strava to map 10,000km of cycling with Python, R and ggplot"><meta itemprop=name content="Strava rides map in R"><meta itemprop=description content="Scraping Strava to map 10,000km of cycling with Python, R and ggplot"><meta itemprop=datePublished content="2019-01-02T00:00:00+00:00"><meta itemprop=dateModified content="2019-01-02T00:00:00+00:00"><meta itemprop=wordCount content="832"><meta itemprop=image content="https://basilesimon.fr/assets/author.jpg"><meta itemprop=keywords content="R,Viz"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:720px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px}div.highlight code{background-color:unset;color:initial}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style><base href=https://basilesimon.fr/><link rel=stylesheet href=main.css><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono&display=swap" rel=stylesheet><link rel=alternate type=application/rss+xml href=https://basilesimon.fr/blog/index.xml title="ðŸ‘‹ hi, Iâ€™m basile"><link rel=canonical href=https://basilesimon.fr/blog/strava-rides-map-in-r/><meta property="og:image" content="https://blog.basilesimon.fr/assets/strava-map-final.jpeg"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@basilesimon"><meta name=twitter:creator content="@basilesimon"><meta name=twitter:image content="https://blog.basilesimon.fr/assets/strava-map-final.jpeg"><meta name=author content="Basile Simon"><meta name=robots content="max-image-preview:large"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Strava rides map in R","url":"https://basilesimon.fr/blog/strava-rides-map-in-r/","datePublished":"2019-01-02T00:00:00Z","dateModified":"2019-01-02T00:00:00Z","description":"Scraping Strava to map 10,000km of cycling with Python, R and ggplot","image":{"@type":"ImageObject","url":"https://blog.basilesimon.fr/assets/strava-map-final.jpeg","width":1200,"height":630},"keywords":"r, viz","wordCount":832,"author":{"@type":"Person","@id":"https:\/\/basilesimon.fr\/#person","name":"Basile Simon","url":"https://basilesimon.fr/","image":{"@type":"ImageObject","url":"https:\/\/basilesimon.fr\/\/assets\/author.jpg"},"jobTitle":"Research Scholar","affiliation":[{"@type":"Organization","name":"Starling Lab for Data Integrity","url":"https://starlinglab.org/","parentOrganization":[{"@type":"CollegeOrUniversity","name":"Stanford University","url":"https://www.stanford.edu/"},{"@type":"CollegeOrUniversity","name":"University of Southern California","url":"https://www.usc.edu/"}]}],"alumniOf":[{"@type":"Organization","name":"BBC News Labs"},{"@type":"Organization","name":"Reuters"},{"@type":"Organization","name":"The Times and The Sunday Times"}],"sameAs":["https:\/\/vis.social\/@basilesimon","https:\/\/github.com\/basilesimon","https:\/\/bsky.app\/profile\/basilesimon.bsky.social","https://twitter.com/basilesimon"]},"publisher":{"@type":"Person","@id":"https:\/\/basilesimon.fr\/#person"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://basilesimon.fr/blog/strava-rides-map-in-r/"},"inLanguage":"en-GB","copyrightHolder":{"@type":"Person","@id":"https:\/\/basilesimon.fr\/#person"},"copyrightYear":"2019","license":"https://creativecommons.org/licenses/by/4.0/"}</script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "dbdcfc9895e340f8a4e734b917d51280"}'></script><script data-goatcounter=https://deptoolkit.goatcounter.com/count async src=//gc.zgo.at/count.js></script></head><body><header><a href=/ class=title><h2>ðŸ‘‹ hi, Iâ€™m basile</h2></a><nav><a href=/>Home</a>
<a href=/blog>Blog</a></nav></header><main><article class=single><h1>Strava rides map in R</h1><p><i><time datetime=2019-01-02 pubdate>02 Jan, 2019</time></i></p><div class=content><p><img src=assets/strava-map-final.jpeg alt></p><p>This is a Christmas present to myself to celebrate 10,000km of commuting on my bicycle: a lovely frame print of all my GPS traces on a home-made map of London. Here&rsquo;s how I made it.</p><p><em>This blog was contributed to <a href=https://www.r-bloggers.com/>R Bloggers</a></em></p><hr><h2 id=step-one-getting-strava-data>Step one: getting Strava data</h2><p>The process has become slightly convoluted in May 2018. In the past, it was possible to download a Strava archive which contained all activities as GPX; however, GDPR regulations <a href=https://support.strava.com/hc/en-us/community/posts/360014914631-Activities-in-the-new-bulk-export-feature-have-meaningless-names-and-multiple-formats->led to a change in bulk export format</a>.</p><p>Anyway: <a href=https://www.strava.com/athlete/delete_your_account>request your Strava archive</a>, wait for the email, download it.</p><p><code>activities.csv</code> gives us a list of activities&mldr; which we can then scrape from Strava.</p><pre tabindex=0><code>$ cat activities/activities.csv | head -5
id,date,name,type,description,elapsed_time,distance,commute,gear,filename
1988225457,2018-11-27 19:11:32,Evening Ride,Ride,&#34;&#34;,1468,6075.0,true,1x1x8,activities/2125648250.fit.gz
1992478096,2018-11-29 10:02:58,Morning Ride,Ride,&#34;&#34;,1449,5869.0,true,1x1x8,activities/2130096306.fit.gz
1992478209,2018-11-29 23:04:16,Night Ride,Ride,&#34;&#34;,1166,5930.0,true,1x1x8,activities/2130096453.fit.gz
1992479540,2018-11-30 08:51:29,Morning Ride,Ride,&#34;&#34;,1427,6563.0,true,Michel le fixie,activities/2130097780.fit.gz
</code></pre><p>Clone <a href=https://github.com/hugovk/strava-tools>hugovk/strava-tools</a>, a set of Python tools to do automate interactions with Strava. There are some instructions at the top of <code>download_fit_as_gpx.py</code>.</p><p>Follow these before running <code>$ python download_fit_as_gpx.py</code></p><p>Some time later&mldr; here we are!</p><pre tabindex=0><code>$ ls activities/activities | head -5
20160908-170525-Ride.gpx
20160909-080222-Ride.gpx
20160909-180740-Ride.gpx
20160912-081014-Ride.gpx
20160912-172611-Ride.gpx
</code></pre><hr><h2 id=step-two-ingesting-activities-in-r>Step two: Ingesting activities in R</h2><p>Install <a href=https://github.com/marcusvolz/strava>marcusvolz/strava</a>, an excellent suite of R functions that help us load activities in a (big, big) dataframe.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#900;font-weight:700>library</span>(devtools)
</span></span><span style=display:flex><span>devtools<span style=color:#000;font-weight:700>::</span><span style=color:#900;font-weight:700>install_github</span>(<span style=color:#d14>&#34;marcusvolz/strava&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#900;font-weight:700>library</span>(strava)
</span></span><span style=display:flex><span><span style=color:#900;font-weight:700>library</span>(tidyverse)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># main ingestion method</span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># ACHTUNG: slow!</span>
</span></span><span style=display:flex><span>data  <span style=color:#000;font-weight:700>&lt;-</span>  <span style=color:#900;font-weight:700>process_data</span>(<span style=color:#d14>&#34;./activities/activities/&#34;</span>)
</span></span><span style=display:flex><span>data <span style=color:#000;font-weight:700>%&gt;%</span> <span style=color:#900;font-weight:700>head</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  id      lat      lon   ele                time dist_to_prev    cumdist time_diff_to_prev  cumtime
</span></span><span style=display:flex><span><span style=color:#099>1</span>  <span style=color:#099>1</span> <span style=color:#099>45.78514</span> <span style=color:#099>4.717282</span> <span style=color:#099>295.7</span> <span style=color:#099>2015-12-26</span> <span style=color:#099>11</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>21</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>48</span>  <span style=color:#099>0.000000000</span> <span style=color:#099>0.00000000</span>                 <span style=color:#099>0</span>        <span style=color:#099>0</span>
</span></span><span style=display:flex><span><span style=color:#099>2</span>  <span style=color:#099>1</span> <span style=color:#099>45.78512</span> <span style=color:#099>4.717559</span> <span style=color:#099>295.3</span> <span style=color:#099>2015-12-26</span> <span style=color:#099>11</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>22</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>12</span>  <span style=color:#099>0.021643479</span> <span style=color:#099>0.02164348</span>                <span style=color:#099>24</span>       <span style=color:#099>24</span>
</span></span><span style=display:flex><span><span style=color:#099>3</span>  <span style=color:#099>1</span> <span style=color:#099>45.78512</span> <span style=color:#099>4.717573</span> <span style=color:#099>295.2</span> <span style=color:#099>2015-12-26</span> <span style=color:#099>11</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>22</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>13</span>  <span style=color:#099>0.001111138</span> <span style=color:#099>0.02275462</span>                 <span style=color:#099>1</span>       <span style=color:#099>25</span>
</span></span><span style=display:flex><span><span style=color:#099>4</span>  <span style=color:#099>1</span> <span style=color:#099>45.78512</span> <span style=color:#099>4.717583</span> <span style=color:#099>295.2</span> <span style=color:#099>2015-12-26</span> <span style=color:#099>11</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>22</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>17</span>  <span style=color:#099>0.000785528</span> <span style=color:#099>0.02354015</span>                 <span style=color:#099>4</span>       <span style=color:#099>29</span>
</span></span><span style=display:flex><span><span style=color:#099>5</span>  <span style=color:#099>1</span> <span style=color:#099>45.78509</span> <span style=color:#099>4.717684</span> <span style=color:#099>295.1</span> <span style=color:#099>2015-12-26</span> <span style=color:#099>11</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>22</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>38</span>  <span style=color:#099>0.008715879</span> <span style=color:#099>0.03225602</span>                <span style=color:#099>21</span>       <span style=color:#099>50</span>
</span></span><span style=display:flex><span><span style=color:#099>6</span>  <span style=color:#099>1</span> <span style=color:#099>45.78508</span> <span style=color:#099>4.717694</span> <span style=color:#099>295.1</span> <span style=color:#099>2015-12-26</span> <span style=color:#099>11</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>22</span><span style=color:#000;font-weight:700>:</span><span style=color:#099>39</span>  <span style=color:#099>0.001181249</span> <span style=color:#099>0.03343727</span>                 <span style=color:#099>1</span>        <span style=color:#099>5</span>
</span></span></code></pre></div><hr><h2 id=step-three-visualising-our-activities>Step three: Visualising our activities</h2><p>We can piece together a simple plot (besides throwing a caveman-like <code>plot(data)</code>) limited to London:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#900;font-weight:700>library</span>(ggplot2)
</span></span><span style=display:flex><span>theme_opts<span style=color:#000;font-weight:700>&lt;-</span><span style=color:#900;font-weight:700>list</span>(<span style=color:#900;font-weight:700>theme</span>(panel.grid.minor <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>element_blank</span>(),
</span></span><span style=display:flex><span>  panel.background <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>element_blank</span>(),
</span></span><span style=display:flex><span>  plot.background <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>element_blank</span>(),
</span></span><span style=display:flex><span>  axis.line <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>element_blank</span>(),
</span></span><span style=display:flex><span>  axis.text.x <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>element_blank</span>(),
</span></span><span style=display:flex><span>  axis.text.y <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>element_blank</span>(),
</span></span><span style=display:flex><span>  axis.ticks <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>element_blank</span>(),
</span></span><span style=display:flex><span>  axis.title.x <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>element_blank</span>(),
</span></span><span style=display:flex><span>  axis.title.y <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>element_blank</span>(),
</span></span><span style=display:flex><span>  plot.title <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>element_blank</span>(),
</span></span><span style=display:flex><span>  panel.grid.major <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>element_line</span>(colour <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#39;transparent&#39;</span>),
</span></span><span style=display:flex><span>  legend.position <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#34;none&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#900;font-weight:700>ggplot</span>(data,
</span></span><span style=display:flex><span>  <span style=color:#900;font-weight:700>aes</span>(lon, lat, group <span style=color:#000;font-weight:700>=</span> id)) <span style=color:#000;font-weight:700>+</span>
</span></span><span style=display:flex><span>  <span style=color:#900;font-weight:700>geom_path</span>(colour<span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#34;steelblue&#34;</span>,alpha <span style=color:#000;font-weight:700>=</span> <span style=color:#099>0.2</span>) <span style=color:#000;font-weight:700>+</span> 
</span></span><span style=display:flex><span>  <span style=color:#900;font-weight:700>coord_map</span>(projection <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#34;mercator&#34;</span>, 
</span></span><span style=display:flex><span>    xlim <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>c</span>(<span style=color:#099>-0.41</span>, <span style=color:#099>0.08</span>), 
</span></span><span style=display:flex><span>    ylim <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>c</span>(<span style=color:#099>51.42</span>, <span style=color:#099>51.73</span>), clip <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#34;on&#34;</span>) <span style=color:#000;font-weight:700>+</span>
</span></span><span style=display:flex><span>  theme_opts
</span></span></code></pre></div><p><img src=assets/strava-map-1.png alt></p><p>Obviously we are going to need some geographical landmarks to get our bearings. <a href=https://github.com/geotheory/londonShapefiles/>geotheory/londonShapefiles</a> is one of the simplest and quickest ways to get London boundaries loaded in - and that includes the river Thames.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#900;font-weight:700>library</span>(devtools)
</span></span><span style=display:flex><span><span style=color:#900;font-weight:700>install_github</span>(<span style=color:#d14>&#34;geotheory/londonShapefiles&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#900;font-weight:700>library</span>(<span style=color:#d14>&#34;londonShapefiles&#34;</span>)
</span></span><span style=display:flex><span>thames <span style=color:#000;font-weight:700>&lt;-</span> <span style=color:#900;font-weight:700>load_thames</span>()
</span></span><span style=display:flex><span>thames.proj <span style=color:#000;font-weight:700>&lt;-</span> <span style=color:#900;font-weight:700>spTransform</span>(thames, <span style=color:#900;font-weight:700>CRS</span>(<span style=color:#d14>&#34;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs&#34;</span>))
</span></span><span style=display:flex><span>thames.df <span style=color:#000;font-weight:700>&lt;-</span> <span style=color:#900;font-weight:700>fortify</span>(thames.proj)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#900;font-weight:700>ggplot</span>() <span style=color:#000;font-weight:700>+</span>
</span></span><span style=display:flex><span>  <span style=color:#900;font-weight:700>geom_polygon</span>(thames.df,
</span></span><span style=display:flex><span>   mapping<span style=color:#000;font-weight:700>=</span><span style=color:#900;font-weight:700>aes</span>(long, lat, group <span style=color:#000;font-weight:700>=</span> group,
</span></span><span style=display:flex><span>    fill <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>I</span>(<span style=color:#d14>&#34;skyblue&#34;</span>)), alpha <span style=color:#000;font-weight:700>=</span> <span style=color:#099>0.4</span>) <span style=color:#000;font-weight:700>+</span>
</span></span><span style=display:flex><span>  <span style=color:#900;font-weight:700>geom_path</span>(data,
</span></span><span style=display:flex><span>    mapping<span style=color:#000;font-weight:700>=</span><span style=color:#900;font-weight:700>aes</span>(lon, lat, group <span style=color:#000;font-weight:700>=</span> id,
</span></span><span style=display:flex><span>    alpha <span style=color:#000;font-weight:700>=</span> <span style=color:#099>0.9</span>, color <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>I</span>(<span style=color:#d14>&#34;tomato&#34;</span>)),
</span></span><span style=display:flex><span>    size<span style=color:#000;font-weight:700>=</span><span style=color:#099>1</span><span style=color:#000;font-weight:700>/</span><span style=color:#099>3</span>) <span style=color:#000;font-weight:700>+</span>
</span></span><span style=display:flex><span>  <span style=color:#900;font-weight:700>coord_map</span>(projection <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#34;mercator&#34;</span>,
</span></span><span style=display:flex><span>    xlim <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>c</span>(<span style=color:#099>-0.41</span>, <span style=color:#099>0.08</span>),
</span></span><span style=display:flex><span>    ylim <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>c</span>(<span style=color:#099>51.42</span>, <span style=color:#099>51.73</span>)) <span style=color:#000;font-weight:700>+</span>
</span></span><span style=display:flex><span>  theme_opts
</span></span></code></pre></div><p><img src=assets/strava-map-2.png alt></p><p>But behold, we can also get data straight from Open Street Map thanks to <a href=https://cran.r-project.org/web/packages/osmdata/vignettes/osmdata.html>osmdata</a>. The syntax is relatively concise and OSM&rsquo;s web interface allows you to query features directly from there:</p><p><img src=https://i.gyazo.com/4f3440eea455f9f94ce42e46444cb838.gif alt></p><p>In our example, we grab all the parks in London and them use <code>geom_sf()</code> to represent both the <code>polygons</code> and <code>multipolygons</code> (the <code>osmdata</code>object <a href=https://cran.r-project.org/web/packages/osmdata/vignettes/osmdata.html#3_the_osmdata_object>has plenty inside it</a>). We need both polygons and multipolygons because, according to the OSM wiki:</p><blockquote><p>Any area that is more complex than that (e.g., because its outline consists of several ways joined together, or because the area consists of multiple disjunct parts, or has holes) requires a <em>multipolygon</em> relation.</p></blockquote><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#900;font-weight:700>library</span>(osmdata)
</span></span><span style=display:flex><span>parks2 <span style=color:#000;font-weight:700>&lt;-</span> <span style=color:#900;font-weight:700>opq</span>(bbox <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>c</span>(<span style=color:#099>-0.41</span>, <span style=color:#099>51.42</span>,
</span></span><span style=display:flex><span>  <span style=color:#099>0.08</span>, <span style=color:#099>51.73</span>)) <span style=color:#000;font-weight:700>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#900;font-weight:700>add_osm_feature</span>(key <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#39;leisure&#39;</span>,
</span></span><span style=display:flex><span>    value <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#34;park&#34;</span>) <span style=color:#000;font-weight:700>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#900;font-weight:700>osmdata_sf</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#900;font-weight:700>ggplot</span>() <span style=color:#000;font-weight:700>+</span>
</span></span><span style=display:flex><span>  <span style=color:#900;font-weight:700>geom_polygon</span>(thames.df,
</span></span><span style=display:flex><span>   mapping<span style=color:#000;font-weight:700>=</span><span style=color:#900;font-weight:700>aes</span>(long, lat, group <span style=color:#000;font-weight:700>=</span> group,
</span></span><span style=display:flex><span>    fill <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>I</span>(<span style=color:#d14>&#34;skyblue&#34;</span>)), alpha <span style=color:#000;font-weight:700>=</span> <span style=color:#099>0.4</span>) <span style=color:#000;font-weight:700>+</span>
</span></span><span style=display:flex><span>  <span style=color:#900;font-weight:700>geom_sf</span>(parks2<span style=color:#000;font-weight:700>$</span>osm_polygons,
</span></span><span style=display:flex><span>   mapping<span style=color:#000;font-weight:700>=</span><span style=color:#900;font-weight:700>aes</span>(fill <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>I</span>(<span style=color:#d14>&#34;springgreen4&#34;</span>),
</span></span><span style=display:flex><span>    color <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>I</span>(<span style=color:#d14>&#34;transparent&#34;</span>)),
</span></span><span style=display:flex><span>    alpha <span style=color:#000;font-weight:700>=</span> <span style=color:#099>0.4</span>) <span style=color:#000;font-weight:700>+</span>
</span></span><span style=display:flex><span>  <span style=color:#900;font-weight:700>geom_sf</span>(parks2<span style=color:#000;font-weight:700>$</span>osm_multipolygons,
</span></span><span style=display:flex><span>   mapping<span style=color:#000;font-weight:700>=</span><span style=color:#900;font-weight:700>aes</span>(fill <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>I</span>(<span style=color:#d14>&#34;springgreen4&#34;</span>),
</span></span><span style=display:flex><span>   color <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>I</span>(<span style=color:#d14>&#34;transparent&#34;</span>)), alpha <span style=color:#000;font-weight:700>=</span> <span style=color:#099>0.4</span>) <span style=color:#000;font-weight:700>+</span>
</span></span><span style=display:flex><span>  <span style=color:#900;font-weight:700>geom_path</span>(data,
</span></span><span style=display:flex><span>  mapping<span style=color:#000;font-weight:700>=</span><span style=color:#900;font-weight:700>aes</span>(lon, lat, group <span style=color:#000;font-weight:700>=</span> id,
</span></span><span style=display:flex><span>   alpha <span style=color:#000;font-weight:700>=</span> <span style=color:#099>0.9</span>, color <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>I</span>(<span style=color:#d14>&#34;tomato&#34;</span>)),
</span></span><span style=display:flex><span>   size<span style=color:#000;font-weight:700>=</span><span style=color:#099>1</span><span style=color:#000;font-weight:700>/</span><span style=color:#099>3</span>) <span style=color:#000;font-weight:700>+</span>
</span></span><span style=display:flex><span>  <span style=color:#900;font-weight:700>coord_sf</span>(xlim <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>c</span>(<span style=color:#099>-0.41</span>, <span style=color:#099>0.08</span>),
</span></span><span style=display:flex><span>           ylim <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>c</span>(<span style=color:#099>51.42</span>, <span style=color:#099>51.73</span>)) <span style=color:#000;font-weight:700>+</span>
</span></span><span style=display:flex><span>  theme_opts
</span></span></code></pre></div><p><img src=assets/strava-map-3.png alt></p><hr><p>Well, we&rsquo;re almost there. For this first draft I stopped at the map above, exported an SVG and sent that to the lab for printing.</p><p>There is no limit to how much you can play with this data. One thing that really struck me was how imprecise my GPS tracking devices were in the City of London (despite being prosumer equipment). Below is a representation of one year of data, on which I&rsquo;ve overlaid the OSM paths corresponding to the streets around Bishopsgate, Cheapside, Monument, Cannon Street, Aldgate, Smithfields, London Bridge and Blackfriars.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span>streets <span style=color:#000;font-weight:700>&lt;-</span> <span style=color:#900;font-weight:700>opq</span>(bbox <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>c</span>(<span style=color:#099>-0.21</span>, <span style=color:#099>51.47</span>,
</span></span><span style=display:flex><span>  <span style=color:#099>0.05</span>, <span style=color:#099>51.61</span>)) <span style=color:#000;font-weight:700>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#900;font-weight:700>add_osm_feature</span>(key <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#39;highway&#39;</span>,
</span></span><span style=display:flex><span>  value <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#34;primary&#34;</span>) <span style=color:#000;font-weight:700>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#900;font-weight:700>osmdata_sf</span>()
</span></span><span style=display:flex><span>streets2 <span style=color:#000;font-weight:700>&lt;-</span> <span style=color:#900;font-weight:700>opq</span>(bbox <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>c</span>(<span style=color:#099>-0.21</span>, <span style=color:#099>51.47</span>,
</span></span><span style=display:flex><span>  <span style=color:#099>0.05</span>, <span style=color:#099>51.61</span>)) <span style=color:#000;font-weight:700>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#900;font-weight:700>add_osm_feature</span>(key <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#39;highway&#39;</span>,
</span></span><span style=display:flex><span>  value <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#34;secondary&#34;</span>) <span style=color:#000;font-weight:700>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#900;font-weight:700>osmdata_sf</span>()
</span></span><span style=display:flex><span>streets3 <span style=color:#000;font-weight:700>&lt;-</span> <span style=color:#900;font-weight:700>opq</span>(bbox <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>c</span>(<span style=color:#099>-0.21</span>, <span style=color:#099>51.47</span>,
</span></span><span style=display:flex><span>  <span style=color:#099>0.05</span>, <span style=color:#099>51.61</span>)) <span style=color:#000;font-weight:700>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#900;font-weight:700>add_osm_feature</span>(key <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#39;highway&#39;</span>,
</span></span><span style=display:flex><span>  value <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#34;tertiary&#34;</span>) <span style=color:#000;font-weight:700>%&gt;%</span>
</span></span><span style=display:flex><span>  <span style=color:#900;font-weight:700>osmdata_sf</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>+</span> <span style=color:#900;font-weight:700>geom_sf</span>(streets<span style=color:#000;font-weight:700>$</span>osm_lines,
</span></span><span style=display:flex><span>   mapping<span style=color:#000;font-weight:700>=</span><span style=color:#900;font-weight:700>aes</span>(fill <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>I</span>(<span style=color:#d14>&#34;transparent&#34;</span>),
</span></span><span style=display:flex><span>   color <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>I</span>(<span style=color:#d14>&#34;darkgray&#34;</span>)), size <span style=color:#000;font-weight:700>=</span> <span style=color:#099>0.5</span>) <span style=color:#000;font-weight:700>+</span>
</span></span><span style=display:flex><span><span style=color:#900;font-weight:700>geom_sf</span>(streets2<span style=color:#000;font-weight:700>$</span>osm_lines,
</span></span><span style=display:flex><span>   mapping<span style=color:#000;font-weight:700>=</span><span style=color:#900;font-weight:700>aes</span>(fill <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>I</span>(<span style=color:#d14>&#34;transparent&#34;</span>),
</span></span><span style=display:flex><span>   color <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>I</span>(<span style=color:#d14>&#34;darkgray&#34;</span>)), size <span style=color:#000;font-weight:700>=</span> <span style=color:#099>0.3</span>) <span style=color:#000;font-weight:700>+</span>
</span></span><span style=display:flex><span><span style=color:#900;font-weight:700>geom_sf</span>(streets3<span style=color:#000;font-weight:700>$</span>osm_lines,
</span></span><span style=display:flex><span>   mapping<span style=color:#000;font-weight:700>=</span><span style=color:#900;font-weight:700>aes</span>(fill <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>I</span>(<span style=color:#d14>&#34;transparent&#34;</span>),
</span></span><span style=display:flex><span>   color <span style=color:#000;font-weight:700>=</span> <span style=color:#900;font-weight:700>I</span>(<span style=color:#d14>&#34;darkgray&#34;</span>)), size <span style=color:#000;font-weight:700>=</span> <span style=color:#099>0.1</span>) 
</span></span></code></pre></div><p><img src=assets/strava-map-4.png alt></p></div><p><a href=https://basilesimon.fr/tags/r/>#R</a>
<a href=https://basilesimon.fr/tags/viz/>#Viz</a></p><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https:\/\/basilesimon.fr\/"},{"@type":"ListItem","position":2,"name":"Blog","item":"https:\/\/basilesimon.fr\/blog/"},{"@type":"ListItem","position":3,"name":"Strava rides map in R","item":"https:\/\/basilesimon.fr\/blog\/strava-rides-map-in-r\/"}]}</script></article></main><footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo Ê•â€¢á´¥â€¢Ê” Bear</a></footer></body></html>